<?php
session_start();

// ============================================
// CONFIGURACI√ìN DE LA BASE DE DATOS (SQLite)
// ============================================
define('DB_FILE', 'rifas.db');

// Inicializar base de datos si no existe
function initDatabase() {
    if (!file_exists(DB_FILE)) {
        $db = new SQLite3(DB_FILE);
        
        // Tabla de usuarios
        $db->exec("CREATE TABLE usuarios (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            username TEXT UNIQUE NOT NULL,
            password TEXT NOT NULL,
            es_admin BOOLEAN DEFAULT 0,
            fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP
        )");
        
        // Tabla de configuraci√≥n
        $db->exec("CREATE TABLE configuracion (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            titulo_sorteo TEXT DEFAULT 'Sorteo Especial',
            fecha_sorteo DATE DEFAULT (date('now', '+30 days')),
            hora_sorteo TEXT DEFAULT '20:00',
            precio_boleto REAL DEFAULT 10.00,
            premio_principal REAL DEFAULT 5000.00,
            estado TEXT DEFAULT 'activo'
        )");
        
        // Insertar configuraci√≥n por defecto
        $db->exec("INSERT INTO configuracion DEFAULT VALUES");
        
        // Tabla de eventos
        $db->exec("CREATE TABLE eventos (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            titulo TEXT NOT NULL,
            descripcion TEXT,
            fecha DATE NOT NULL,
            hora TEXT,
            activo BOOLEAN DEFAULT 1
        )");
        
        // Crear usuario admin por defecto (usuario: admin, contrase√±a: admin123)
        $hash = password_hash('admin123', PASSWORD_DEFAULT);
        $db->exec("INSERT INTO usuarios (username, password, es_admin) VALUES ('admin', '$hash', 1)");
        
        $db->close();
    }
}

// Inicializar BD
initDatabase();

// ============================================
// FUNCIONES DE BASE DE DATOS
// ============================================
function getDB() {
    return new SQLite3(DB_FILE);
}

function ejecutarConsulta($sql, $params = []) {
    $db = getDB();
    $stmt = $db->prepare($sql);
    
    foreach ($params as $key => $value) {
        $stmt->bindValue($key, $value);
    }
    
    $result = $stmt->execute();
    
    if (stripos($sql, 'SELECT') === 0) {
        $rows = [];
        while ($row = $result->fetchArray(SQLITE3_ASSOC)) {
            $rows[] = $row;
        }
        return $rows;
    } else {
        return $db->changes();
    }
}

// ============================================
// FUNCIONES DE AUTENTICACI√ìN
// ============================================
function estaLogueado() {
    return isset($_SESSION['usuario_id']);
}

function esAdministrador() {
    return estaLogueado() && isset($_SESSION['es_admin']) && $_SESSION['es_admin'] == 1;
}

function requiereLogin() {
    if (!estaLogueado()) {
        header('Location: ?action=login');
        exit();
    }
}

function requiereAdmin() {
    requiereLogin();
    if (!esAdministrador()) {
        die('Acceso denegado. Solo administradores pueden acceder a esta secci√≥n.');
    }
}

// ============================================
// MANEJO DE ACCIONES
// ============================================
$action = $_GET['action'] ?? 'inicio';

switch ($action) {
    case 'login':
        handleLogin();
        break;
    case 'logout':
        handleLogout();
        break;
    case 'register':
        handleRegister();
        break;
    case 'admin':
        requiereAdmin();
        mostrarPanelAdmin();
        break;
    case 'config':
        requiereAdmin();
        mostrarConfiguracion();
        break;
    case 'save_config':
        requiereAdmin();
        guardarConfiguracion();
        break;
    default:
        mostrarInicio();
        break;
}

// ============================================
// MANEJADORES DE ACCIONES
// ============================================
function handleLogin() {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $username = trim($_POST['username'] ?? '');
        $password = $_POST['password'] ?? '';
        
        $db = getDB();
        $stmt = $db->prepare("SELECT * FROM usuarios WHERE username = :username");
        $stmt->bindValue(':username', $username, SQLITE3_TEXT);
        $result = $stmt->execute();
        $usuario = $result->fetchArray(SQLITE3_ASSOC);
        
        if ($usuario && password_verify($password, $usuario['password'])) {
            $_SESSION['usuario_id'] = $usuario['id'];
            $_SESSION['username'] = $usuario['username'];
            $_SESSION['es_admin'] = $usuario['es_admin'];
            
            if (esAdministrador()) {
                header('Location: ?action=admin');
            } else {
                header('Location: ?action=inicio');
            }
            exit();
        } else {
            mostrarLogin('Usuario o contrase√±a incorrectos');
        }
    } else {
        mostrarLogin();
    }
    exit();
}

function handleLogout() {
    session_destroy();
    header('Location: ?action=login');
    exit();
}

function handleRegister() {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $username = trim($_POST['username'] ?? '');
        $password = $_POST['password'] ?? '';
        $confirm_password = $_POST['confirm_password'] ?? '';
        
        if (empty($username) || empty($password)) {
            mostrarRegistro('Todos los campos son obligatorios');
            return;
        }
        
        if ($password !== $confirm_password) {
            mostrarRegistro('Las contrase√±as no coinciden');
            return;
        }
        
        if (strlen($password) < 6) {
            mostrarRegistro('La contrase√±a debe tener al menos 6 caracteres');
            return;
        }
        
        // Verificar si usuario existe
        $db = getDB();
        $stmt = $db->prepare("SELECT id FROM usuarios WHERE username = :username");
        $stmt->bindValue(':username', $username, SQLITE3_TEXT);
        $result = $stmt->execute();
        
        if ($result->fetchArray()) {
            mostrarRegistro('El usuario ya existe');
            return;
        }
        
        // Crear usuario
        $hash = password_hash($password, PASSWORD_DEFAULT);
        $stmt = $db->prepare("INSERT INTO usuarios (username, password) VALUES (:username, :password)");
        $stmt->bindValue(':username', $username, SQLITE3_TEXT);
        $stmt->bindValue(':password', $hash, SQLITE3_TEXT);
        
        if ($stmt->execute()) {
            $_SESSION['usuario_id'] = $db->lastInsertRowID();
            $_SESSION['username'] = $username;
            $_SESSION['es_admin'] = 0;
            header('Location: ?action=inicio');
            exit();
        } else {
            mostrarRegistro('Error al registrar usuario');
        }
    } else {
        mostrarRegistro();
    }
    exit();
}

function guardarConfiguracion() {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $config = [
            ':titulo' => trim($_POST['titulo_sorteo']),
            ':fecha' => $_POST['fecha_sorteo'],
            ':hora' => $_POST['hora_sorteo'],
            ':precio' => floatval($_POST['precio_boleto']),
            ':premio' => floatval($_POST['premio_principal']),
            ':estado' => $_POST['estado']
        ];
        
        $db = getDB();
        $stmt = $db->prepare("
            UPDATE configuracion 
            SET titulo_sorteo = :titulo,
                fecha_sorteo = :fecha,
                hora_sorteo = :hora,
                precio_boleto = :precio,
                premio_principal = :premio,
                estado = :estado
            WHERE id = 1
        ");
        
        foreach ($config as $key => $value) {
            $stmt->bindValue($key, $value);
        }
        
        $stmt->execute();
        
        $_SESSION['mensaje'] = 'Configuraci√≥n guardada correctamente';
        header('Location: ?action=config');
        exit();
    }
}

// ============================================
// VISTAS
// ============================================
function mostrarLogin($error = '') {
    ?>
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Iniciar Sesi√≥n - Sistema de Rifas</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .login-container {
                background: white;
                padding: 40px;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                width: 100%;
                max-width: 400px;
            }
            .logo {
                text-align: center;
                margin-bottom: 30px;
            }
            .logo h1 {
                color: #333;
                margin-bottom: 10px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-group label {
                display: block;
                margin-bottom: 5px;
                color: #555;
                font-weight: 500;
            }
            .form-control {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #ddd;
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }
            .form-control:focus {
                border-color: #667eea;
                outline: none;
            }
            .btn {
                width: 100%;
                padding: 12px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                cursor: pointer;
                transition: transform 0.3s ease;
            }
            .btn:hover {
                transform: translateY(-2px);
            }
            .error {
                background: #ff6b6b;
                color: white;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 20px;
                text-align: center;
            }
            .links {
                text-align: center;
                margin-top: 20px;
            }
            .links a {
                color: #667eea;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="login-container">
            <div class="logo">
                <h1>üéØ Sistema de Rifas</h1>
                <p>Inicia sesi√≥n para continuar</p>
            </div>
            
            <?php if ($error): ?>
                <div class="error"><?php echo htmlspecialchars($error); ?></div>
            <?php endif; ?>
            
            <form method="POST" action="?action=login">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" name="password" class="form-control" required>
                </div>
                
                <button type="submit" class="btn">Iniciar Sesi√≥n</button>
            </form>
            
            <div class="links">
                <p>¬øNo tienes cuenta? <a href="?action=register">Reg√≠strate aqu√≠</a></p>
                <p><a href="?action=inicio">Volver al inicio</a></p>
            </div>
        </div>
    </body>
    </html>
    <?php
}

function mostrarRegistro($error = '') {
    ?>
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Registro - Sistema de Rifas</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .register-container {
                background: white;
                padding: 40px;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                width: 100%;
                max-width: 400px;
            }
            .logo {
                text-align: center;
                margin-bottom: 30px;
            }
            .logo h1 {
                color: #333;
                margin-bottom: 10px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-group label {
                display: block;
                margin-bottom: 5px;
                color: #555;
                font-weight: 500;
            }
            .form-control {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #ddd;
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }
            .form-control:focus {
                border-color: #667eea;
                outline: none;
            }
            .btn {
                width: 100%;
                padding: 12px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                cursor: pointer;
                transition: transform 0.3s ease;
            }
            .btn:hover {
                transform: translateY(-2px);
            }
            .error {
                background: #ff6b6b;
                color: white;
                padding: 10px;
                border-radius: 5px;
                margin-bottom: 20px;
                text-align: center;
            }
            .links {
                text-align: center;
                margin-top: 20px;
            }
            .links a {
                color: #667eea;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="register-container">
            <div class="logo">
                <h1>üéØ Sistema de Rifas</h1>
                <p>Crea tu cuenta</p>
            </div>
            
            <?php if ($error): ?>
                <div class="error"><?php echo htmlspecialchars($error); ?></div>
            <?php endif; ?>
            
            <form method="POST" action="?action=register">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" name="password" class="form-control" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Confirmar Contrase√±a</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                </div>
                
                <button type="submit" class="btn">Registrarse</button>
            </form>
            
            <div class="links">
                <p>¬øYa tienes cuenta? <a href="?action=login">Inicia sesi√≥n aqu√≠</a></p>
                <p><a href="?action=inicio">Volver al inicio</a></p>
            </div>
        </div>
    </body>
    </html>
    <?php
}

function mostrarInicio() {
    $config = ejecutarConsulta("SELECT * FROM configuracion LIMIT 1")[0] ?? [];
    $eventos = ejecutarConsulta("SELECT * FROM eventos WHERE fecha >= date('now') ORDER BY fecha ASC LIMIT 5");
    
    // Datos para el calendario
    $mes_actual = date('n');
    $ano_actual = date('Y');
    $hoy = date('j');
    
    $fechas_conmemorativas = [
        1 => [1 => 'A√±o Nuevo', 6 => 'D√≠a de Reyes', 28 => 'Natalicio de Jos√© Mart√≠'],
        2 => [14 => 'D√≠a de San Valent√≠n', 24 => 'D√≠a del Trabajador de la Radio y la Televisi√≥n'],
        3 => [8 => 'D√≠a Internacional de la Mujer', 13 => 'Aniversario del Asalto al Palacio Presidencial'],
        4 => [19 => 'Victoria de Playa Gir√≥n'],
        5 => [1 => 'D√≠a Internacional de los Trabajadores', 17 => 'D√≠a del Campesino'],
        6 => [14 => 'D√≠a de los Trabajadores del Comercio'],
        7 => [26 => 'D√≠a de la Rebeld√≠a Nacional', 30 => 'D√≠a de los M√°rtires de la Revoluci√≥n'],
        8 => [13 => 'Cumplea√±os de Fidel Castro'],
        9 => [28 => 'D√≠a del Comit√© de Defensa de la Revoluci√≥n (CDR)'],
        10 => [8 => 'Aniversario de la Muerte del Che Guevara', 28 => 'D√≠a de la Prensa Cubana'],
        11 => [27 => 'Fusilamiento de los Estudiantes de Medicina'],
        12 => [7 => 'D√≠a de las Madres', 25 => 'Navidad']
    ];
    
    $nombres_meses = [
        1 => 'Enero', 2 => 'Febrero', 3 => 'Marzo', 4 => 'Abril',
        5 => 'Mayo', 6 => 'Junio', 7 => 'Julio', 8 => 'Agosto',
        9 => 'Septiembre', 10 => 'Octubre', 11 => 'Noviembre', 12 => 'Diciembre'
    ];
    
    $nombres_dias = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];
    $dias_mes = cal_days_in_month(CAL_GREGORIAN, $mes_actual, $ano_actual);
    $primer_dia = date('N', strtotime("$ano_actual-$mes_actual-01"));
    ?>
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sistema de Rifas - Inicio</title>
        <style>
            /* ESTILOS COMPLETOS (igual que antes) */
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }
            .container {
                display: grid;
                grid-template-columns: 250px 1fr;
                gap: 20px;
                max-width: 1200px;
                margin: 0 auto;
            }
            .sidebar {
                background: white;
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            .logo {
                text-align: center;
                margin-bottom: 30px;
                padding: 15px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 10px;
                color: white;
            }
            .logo h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            .menu {
                list-style: none;
            }
            .menu-item {
                margin-bottom: 10px;
            }
            .menu-link {
                display: flex;
                align-items: center;
                padding: 12px 15px;
                color: #333;
                text-decoration: none;
                border-radius: 8px;
                transition: all 0.3s ease;
            }
            .menu-link:hover, .menu-link.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                transform: translateX(5px);
            }
            .menu-icon {
                margin-right: 10px;
                font-size: 1.2rem;
            }
            .admin-only {
                border-left: 4px solid #ff6b6b;
                background: #fff5f5;
                margin-top: 20px;
                padding-top: 10px;
            }
            .main-content {
                display: grid;
                grid-template-columns: 1fr 300px;
                gap: 20px;
            }
            .content-area {
                background: white;
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            .section-title {
                color: #333;
                margin-bottom: 25px;
                padding-bottom: 10px;
                border-bottom: 2px solid #667eea;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .carpetas-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            .carpeta {
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                transition: transform 0.3s ease;
                cursor: pointer;
            }
            .carpeta:hover {
                transform: translateY(-5px);
            }
            .portada {
                height: 120px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 2rem;
            }
            .portada-sorteo { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            .portada-eventos { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); }
            .portada-compras { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
            .portada-resultados { background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); }
            .carpeta-info {
                padding: 15px;
            }
            .carpeta-info h3 {
                margin-bottom: 5px;
                color: #333;
            }
            .carpeta-info p {
                color: #666;
                font-size: 0.9rem;
            }
            .calendario-container {
                background: white;
                border-radius: 15px;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                margin-bottom: 20px;
            }
            .calendario-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }
            .mes-ano {
                font-size: 1.3rem;
                font-weight: bold;
                color: #333;
            }
            .dias-semana {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
                margin-bottom: 10px;
            }
            .dia-semana {
                text-align: center;
                font-weight: bold;
                color: #667eea;
                padding: 8px;
                font-size: 0.9rem;
            }
            .dias-mes {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }
            .dia {
                text-align: center;
                padding: 12px 5px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.9rem;
            }
            .dia:hover {
                background: #667eea;
                color: white;
            }
            .dia.actual {
                background: #667eea;
                color: white;
                font-weight: bold;
            }
            .dia.conmemorativo {
                background: #ff6b6b;
                color: white;
                position: relative;
            }
            .dia.conmemorativo::after {
                content: '‚òÖ';
                position: absolute;
                top: 2px;
                right: 2px;
                font-size: 0.8rem;
            }
            .eventos-hoy {
                margin-top: 20px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 10px;
            }
            .relojes-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 30px;
            }
            .reloj {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
            }
            .reloj h3 {
                margin-bottom: 10px;
                font-size: 1.1rem;
            }
            .hora {
                font-size: 2.5rem;
                font-family: 'Courier New', monospace;
                font-weight: bold;
            }
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            .stat-card {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                border-top: 4px solid #667eea;
            }
            .stat-card h3 {
                color: #666;
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            .stat-number {
                font-size: 2rem;
                font-weight: bold;
                color: #333;
            }
            .carrito-icon {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.5rem;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                cursor: pointer;
                z-index: 1000;
            }
            .carrito-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background: #ff6b6b;
                color: white;
                font-size: 0.8rem;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .config-section {
                display: <?php echo esAdministrador() ? 'block' : 'none'; ?>;
                margin-top: 30px;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 2px dashed #ccc;
            }
            .upload-area {
                border: 2px dashed #667eea;
                border-radius: 10px;
                padding: 40px;
                text-align: center;
                background: rgba(102, 126, 234, 0.05);
                cursor: pointer;
            }
            .user-badge {
                display: inline-block;
                padding: 5px 15px;
                background: #667eea;
                color: white;
                border-radius: 20px;
                font-size: 0.9rem;
                margin-left: 10px;
            }
            .admin-badge {
                background: #ff6b6b;
            }
            .logout-btn {
                background: #ff6b6b;
                color: white;
                border: none;
                padding: 5px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 0.9rem;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="logo">
                    <h1><i class="fas fa-gift"></i> Sistema de Rifas</h1>
                    <p>¬°Gana grandes premios!</p>
                </div>
                
                <ul class="menu">
                    <li class="menu-item">
                        <a href="?action=inicio" class="menu-link active">
                            <span class="menu-icon">üè†</span>
                            Inicio
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon">üé´</span>
                            Sorteos Activos
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon">üìÖ</span>
                            Eventos
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon">üõí</span>
                            Mis Compras
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon">üèÜ</span>
                            Resultados
                        </a>
                    </li>
                    
                    <?php if(esAdministrador()): ?>
                    <div class="admin-only">
                        <li class="menu-item">
                            <a href="?action=config" class="menu-link">
                                <span class="menu-icon">‚öôÔ∏è</span>
                                Configuraci√≥n
                            </a>
                        </li>
                        <li class="menu-item">
                            <a href="?action=admin" class="menu-link">
                                <span class="menu-icon">üìä</span>
                                Panel Admin
                            </a>
                        </li>
                    </div>
                    <?php endif; ?>
                    
                    <?php if(estaLogueado()): ?>
                    <li class="menu-item">
                        <a href="?action=logout" class="menu-link" style="background: #ff6b6b; color: white; margin-top: 20px;">
                            <span class="menu-icon">üö™</span>
                            Cerrar Sesi√≥n
                        </a>
                    </li>
                    <?php else: ?>
                    <li class="menu-item">
                        <a href="?action=login" class="menu-link" style="background: #4CAF50; color: white; margin-top: 20px;">
                            <span class="menu-icon">üîê</span>
                            Iniciar Sesi√≥n
                        </a>
                    </li>
                    <?php endif; ?>
                </ul>
            </aside>

            <!-- Main Content -->
            <div class="main-content">
                <div class="content-area">
                    <div class="section-title">
                        <h2>üìã Panel Principal 
                            <span class="user-badge <?php echo esAdministrador() ? 'admin-badge' : ''; ?>">
                                <?php echo estaLogueado() ? htmlspecialchars($_SESSION['username']) : 'Invitado'; ?>
                                <?php echo esAdministrador() ? ' (Admin)' : ''; ?>
                            </span>
                        </h2>
                        <?php if(estaLogueado()): ?>
                            <button class="logout-btn" onclick="location.href='?action=logout'">Cerrar Sesi√≥n</button>
                        <?php else: ?>
                            <button class="logout-btn" onclick="location.href='?action=login'" style="background: #4CAF50;">Iniciar Sesi√≥n</button>
                        <?php endif; ?>
                    </div>

                    <!-- Carpetas -->
                    <h3>üìÅ Mis Carpetas</h3>
                    <div class="carpetas-grid">
                        <div class="carpeta" onclick="location.href='#'">
                            <div class="portada portada-sorteo">
                                üé´
                            </div>
                            <div class="carpeta-info">
                                <h3>Sorteos</h3>
                                <p>Participa en nuestros sorteos activos</p>
                            </div>
                        </div>

                        <div class="carpeta" onclick="location.href='#'">
                            <div class="portada portada-eventos">
                                üìÖ
                            </div>
                            <div class="carpeta-info">
                                <h3>Eventos</h3>
                                <p>Pr√≥ximos eventos y actividades</p>
                            </div>
                        </div>

                        <div class="carpeta" onclick="location.href='#'">
                            <div class="portada portada-compras">
                                üõí
                            </div>
                            <div class="carpeta-info">
                                <h3>Compras</h3>
                                <p>Historial de tus compras</p>
                            </div>
                        </div>

                        <div class="carpeta" onclick="location.href='#'">
                            <div class="portada portada-resultados">
                                üèÜ
                            </div>
                            <div class="carpeta-info">
                                <h3>Resultados</h3>
                                <p>Ganadores de sorteos anteriores</p>
                            </div>
                        </div>
                    </div>

                    <!-- Relojes -->
                    <div class="relojes-container">
                        <div class="reloj">
                            <h3>‚è∞ Hora del Sorteo</h3>
                            <div class="hora" id="reloj-sorteo">--:--:--</div>
                            <div class="fecha">Pr√≥ximo sorteo: <?php echo date('d/m/Y', strtotime($config['fecha_sorteo'] ?? '+30 days')); ?></div>
                        </div>

                        <div class="reloj">
                            <h3>üá®üá∫ Hora de Cuba</h3>
                            <div class="hora" id="reloj-cuba">--:--</div>
                            <div class="fecha"><?php echo date('d/m/Y'); ?></div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas -->
                    <h3>üìä Estad√≠sticas</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Boletos Vendidos</h3>
                            <div class="stat-number">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Recaudaci√≥n Total</h3>
                            <div class="stat-number">$0.00</div>
                        </div>
                        <div class="stat-card">
                            <h3>Usuarios Registrados</h3>
                            <div class="stat-number">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Premios Entregados</h3>
                            <div class="stat-number">0</div>
                        </div>
                    </div>

                    <!-- Configuraci√≥n solo para admin -->
                    <?php if(esAdministrador()): ?>
                    <div class="config-section">
                        <h3>‚öôÔ∏è Configuraci√≥n del Sistema</h3>
                        <div class="upload-area" onclick="alert('√Årea de subida de archivos - Solo visible para administradores')">
                            <div style="font-size: 3rem; color: #667eea; margin-bottom: 15px;">
                                üìÅ
                            </div>
                            <h4>Arrastra y suelta archivos aqu√≠</h4>
                            <p>o haz clic para seleccionar</p>
                            <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                                <em>Esta secci√≥n solo es visible para administradores</em>
                            </p>
                        </div>
                    </div>
                    <?php endif; ?>
                </div>

                <!-- Sidebar Derecha - Calendario -->
                <div class="sidebar">
                    <!-- Calendario -->
                    <div class="calendario-container">
                        <div class="calendario-header">
                            <div class="mes-ano">
                                <?php echo $nombres_meses[$mes_actual] . ' ' . $ano_actual; ?>
                            </div>
                            <div>
                                <button style="background: none; border: none; cursor: pointer; font-size: 1.2rem;" onclick="alert('Cambiar mes anterior')">‚óÄ</button>
                                <button style="background: none; border: none; cursor: pointer; font-size: 1.2rem;" onclick="alert('Cambiar mes siguiente')">‚ñ∂</button>
                            </div>
                        </div>

                        <div class="dias-semana">
                            <?php foreach($nombres_dias as $dia): ?>
                                <div class="dia-semana"><?php echo $dia; ?></div>
                            <?php endforeach; ?>
                        </div>

                        <div class="dias-mes">
                            <?php for($i = 1; $i < $primer_dia; $i++): ?>
                                <div class="dia"></div>
                            <?php endfor; ?>

                            <?php for($dia = 1; $dia <= $dias_mes; $dia++): ?>
                                <?php
                                $es_hoy = ($dia == $hoy);
                                $es_conmemorativo = isset($fechas_conmemorativas[$mes_actual][$dia]);
                                $clases = 'dia';
                                if($es_hoy) $clases .= ' actual';
                                if($es_conmemorativo) $clases .= ' conmemorativo';
                                ?>
                                <div class="<?php echo $clases; ?>" title="<?php echo $es_conmemorativo ? $fechas_conmemorativas[$mes_actual][$dia] : ''; ?>">
                                    <?php echo $dia; ?>
                                </div>
                            <?php endfor; ?>
                        </div>

                        <!-- Eventos del d√≠a -->
                        <div class="eventos-hoy">
                            <h4>üìÖ Eventos de Hoy</h4>
                            <?php
                            $eventos_hoy = array_filter($eventos, function($evento) {
                                return $evento['fecha'] == date('Y-m-d');
                            });
                            
                            if(count($eventos_hoy) > 0): 
                                foreach($eventos_hoy as $evento): ?>
                                    <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                                        <strong><?php echo htmlspecialchars($evento['titulo']); ?></strong>
                                        <p style="margin: 5px 0; font-size: 0.9rem;"><?php echo htmlspecialchars($evento['descripcion']); ?></p>
                                        <small><?php echo date('H:i', strtotime($evento['hora'])); ?></small>
                                    </div>
                                <?php endforeach; 
                            else: ?>
                                <p style="text-align: center; color: #666; margin-top: 10px;">
                                    No hay eventos programados para hoy.
                                </p>
                            <?php endif; ?>
                        </div>
                    </div>

                    <!-- Fechas Conmemorativas del Mes -->
                    <div class="calendario-container">
                        <h4>‚≠ê Fechas Conmemorativas</h4>
                        <div style="margin-top: 15px;">
                            <?php if(isset($fechas_conmemorativas[$mes_actual])): 
                                foreach($fechas_conmemorativas[$mes_actual] as $dia => $evento): ?>
                                    <div style="padding: 8px 0; border-bottom: 1px solid #eee;">
                                        <strong><?php echo $dia . ' de ' . $nombres_meses[$mes_actual]; ?>:</strong>
                                        <span><?php echo $evento; ?></span>
                                    </div>
                                <?php endforeach; 
                            else: ?>
                                <p style="text-align: center; color: #666; padding: 15px 0;">
                                    No hay fechas conmemorativas este mes.
                                </p>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carrito de Compras Flotante -->
        <div class="carrito-icon" onclick="alert('Ir a compras')">
            üõí
            <div class="carrito-badge">0</div>
        </div>

        <script>
            // Reloj del Sorteo
            function actualizarRelojSorteo() {
                const ahora = new Date();
                const hora = ahora.getHours().toString().padStart(2, '0');
                const minutos = ahora.getMinutes().toString().padStart(2, '0');
                const segundos = ahora.getSeconds().toString().padStart(2, '0');
                document.getElementById('reloj-sorteo').textContent = `${hora}:${minutos}:${segundos}`;
            }

            // Reloj de Cuba (hora corta)
            function actualizarRelojCuba() {
                const ahora = new Date();
                const hora = ahora.getHours().toString().padStart(2, '0');
                const minutos = ahora.getMinutes().toString().padStart(2, '0');
                document.getElementById('reloj-cuba').textContent = `${hora}:${minutos}`;
            }

            // Actualizar relojes cada segundo
            setInterval(() => {
                actualizarRelojSorteo();
                actualizarRelojCuba();
            }, 1000);

            // Inicializar relojes
            actualizarRelojSorteo();
            actualizarRelojCuba();

            // Mostrar mensaje de protecci√≥n
            console.log("üîí SISTEMA PROTEGIDO");
            console.log("Modo actual: <?php echo esAdministrador() ? 'ADMINISTRADOR' : (estaLogueado() ? 'USUARIO' : 'INVITADO'); ?>");
            console.log("Las configuraciones solo son accesibles para administradores.");
            
            <?php if(esAdministrador()): ?>
            console.log("‚ö†Ô∏è  ACCESO ADMIN DETECTADO");
            console.log("Tienes acceso completo al sistema.");
            <?php else: ?>
            console.log("‚úÖ Modo seguro activado");
            console.log("Las funciones de administraci√≥n est√°n ocultas.");
            <?php endif; ?>
        </script>
    </body>
    </html>
    <?php
}

function mostrarConfiguracion() {
    requiereAdmin();
    
    $config = ejecutarConsulta("SELECT * FROM configuracion LIMIT 1")[0] ?? [];
    $mensaje = $_SESSION['mensaje'] ?? '';
    unset($_SESSION['mensaje']);
    ?>
    <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n - Sistema de Rifas</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .logo {
            color: white;
            font-size: 1.5rem;
        }
        .config-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .section-title {
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        .form-control:focus {
            border-color: #667eea;
            outline: none;
        }
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-back {
            background: #6c757d;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .admin-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #ff6b6b;
            color: white;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <h1>‚öôÔ∏è Configuraci√≥n del Sistema</h1>
                <p>Panel de Administraci√≥n</p>
            </div>
            <div>
                <span class="admin-badge">Administrador</span>
                <a href="?action=inicio" class="btn btn-back">Volver al Inicio</a>
                <a href="?action=logout" class="btn" style="background: #ff6b6b;">Cerrar Sesi√≥n</a>
            </div>
        </div>
        
        <div class="config-container">
            <?php if ($mensaje): ?>
                <div class="alert success"><?php echo htmlspecialchars($mensaje); ?></div>
            <?php endif; ?>
            
            <div class="section-title">
                <h2>Configuraci√≥n del Sorteo</h2>
            </div>
            
            <form method="POST" action="?action=save_config">
                <div class="form-group">
                    <label for="titulo_sorteo">T√≠tulo del Sorteo</label>
                    <input type="text" id="titulo_sorteo" name="titulo_sorteo" 
                           class="form-control" value="<?php echo htmlspecialchars($config['titulo_sorteo'] ?? 'Sorteo Especial'); ?>" required>
                </div>
                
                <div class="form-group">
                    <label for="fecha_sorteo">Fecha del Sorteo</label>
                    <input type="date" id="fecha_sorteo" name="fecha_sorteo" 
                           class="form-control" value="<?php echo $config['fecha_sorteo'] ?? date('Y-m-d', strtotime('+30 days')); ?>" required>
                </div>
                
                <div class="form-group">
                    <label for="hora_sorteo">Hora del Sorteo</label>
                    <input type="time" id="hora_sorteo" name="hora_sorteo" 
                           class="form-control" value="<?php echo $config['hora_sorteo'] ?? '20:00'; ?>" required>
                </div>
                
                <div class="form-group">
                    <label for="precio_boleto">Precio por Boleto ($)</label>
                    <input type="number" step="0.01" id="precio_boleto" name="precio_boleto" 
                           class="form-control" value="<?php echo $config['precio_boleto'] ?? '10.00'; ?>" required>
                </div>
                
                <div class="form-group">
                    <label for="premio_principal">Premio Principal ($)</label>
                    <input type="number" step="0.01" id="premio_principal" name="premio_principal" 
                           class="form-control" value="<?php echo $config['premio_principal'] ?? '5000.00'; ?>" required>
                </div>
                
                <div class="form-group">
                    <label for="estado">Estado del Sorteo</label>
                    <select id="estado" name="estado" class="form-control" required>
                        <option value="activo" <?php echo ($config['estado'] ?? 'activo') == 'activo' ? 'selected' : ''; ?>>Activo</option>
                        <option value="pausado" <?php echo ($config['estado'] ?? '') == 'pausado' ? 'selected' : ''; ?>>Pausado</option>
                        <option value="finalizado" <?php echo ($config['estado'] ?? '') == 'finalizado' ? 'selected' : ''; ?>>Finalizado</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn">Guardar Configuraci√≥n</button>
                    <a href="?action=inicio" class="btn btn-back" style="margin-left: 10px;">Cancelar</a>
                </div>
            </form>
            
            <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3>‚ö†Ô∏è Informaci√≥n de Seguridad</h3>
                <p>Esta p√°gina solo es accesible para administradores del sistema.</p>
                <p>Los cambios realizados aqu√≠ afectar√°n a todos los usuarios.</p>
                <p><strong>Usuario actual:</strong> <?php echo htmlspecialchars($_SESSION['username'] ?? 'Admin'); ?></p>
                <p><strong>IP:</strong> <?php echo $_SERVER['REMOTE_ADDR']; ?></p>
                <p><strong>√öltimo acceso:</strong> <?php echo date('d/m/Y H:i:s'); ?></p>
            </div>
        </div>
    </div>
    
    <script>
        console.log("üîê PANEL DE ADMINISTRACI√ìN");
        console.log("Acceso restringido verificado.");
        console.log("Usuario: <?php echo htmlspecialchars($_SESSION['username'] ?? 'Admin'); ?>");
        console.log("Nivel: ADMINISTRADOR");
    </script>
</body>
</html>
    <?php
}

function mostrarPanelAdmin() {
    requiereAdmin();
    ?>
    <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Sistema de Rifas</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: white;
        }
        .logo h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        .admin-menu {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-admin {
            background: #ff6b6b;
            color: white;
        }
        .btn-logout {
            background: #dc3545;
            color: white;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .dashboard-card h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
        .admin-actions {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .action-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .action-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }
        .action-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .security-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }
        .admin-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #ff6b6b;
            color: white;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <h1>üìä Panel de Administraci√≥n</h1>
                <p>Control total del sistema de rifas</p>
            </div>
            <div class="admin-menu">
                <a href="?action=inicio" class="btn">Inicio</a>
                <a href="?action=config" class="btn btn-admin">Configuraci√≥n</a>
                <a href="?action=logout" class="btn btn-logout">Cerrar Sesi√≥n</a>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="dashboard-card">
                <h3>üë• Usuarios Registrados</h3>
                <div class="stat-number">0</div>
                <p style="text-align: center; color: #666;">Total de usuarios en el sistema</p>
            </div>
            
            <div class="dashboard-card">
                <h3>üé´ Boletos Vendidos</h3>
                <div class="stat-number">0</div>
                <p style="text-align: center; color: #666;">Total de boletos vendidos</p>
            </div>
            
            <div class="dashboard-card">
                <h3>üí∞ Recaudaci√≥n Total</h3>
                <div class="stat-number">$0.00</div>
                <p style="text-align: center; color: #666;">Dinero recaudado</p>
            </div>
            
            <div class="dashboard-card">
                <h3>üèÜ Premios Entregados</h3>
                <div class="stat-number">0</div>
                <p style="text-align: center; color: #666;">Premios entregados</p>
            </div>
        </div>
        
        <div class="admin-actions">
            <h2>üîß Acciones de Administraci√≥n</h2>
            <div class="actions-grid">
                <div class="action-card" onclick="location.href='?action=config'">
                    <div class="action-icon">‚öôÔ∏è</div>
                    <h4>Configuraci√≥n</h4>
                    <p>Configurar sorteos y sistema</p>
                </div>
                
                <div class="action-card" onclick="alert('Gesti√≥n de usuarios - Pr√≥ximamente')">
                    <div class="action-icon">üë•</div>
                    <h4>Gesti√≥n de Usuarios</h4>
                    <p>Administrar usuarios del sistema</p>
                </div>
                
                <div class="action-card" onclick="alert('Reportes - Pr√≥ximamente')">
                    <div class="action-icon">üìä</div>
                    <h4>Reportes</h4>
                    <p>Generar reportes y estad√≠sticas</p>
                </div>
                
                <div class="action-card" onclick="alert('Eventos - Pr√≥ximamente')">
                    <div class="action-icon">üìÖ</div>
                    <h4>Gesti√≥n de Eventos</h4>
                    <p>Administrar eventos del calendario</p>
                </div>
                
                <div class="action-card" onclick="alert('Backup - Pr√≥ximamente')">
                    <div class="action-icon">üíæ</div>
                    <h4>Backup</h4>
                    <p>Realizar copias de seguridad</p>
                </div>
                
                <div class="action-card" onclick="alert('Logs - Pr√≥ximamente')">
                    <div class="action-icon">üìù</div>
                    <h4>Registros de Actividad</h4>
                    <p>Ver logs del sistema</p>
                </div>
            </div>
        </div>
        
        <div class="security-alert">
            <h3>üîí ZONA RESTRINGIDA</h3>
            <p>Esta √°rea solo es accesible para administradores autorizados.</p>
            <p><strong>Usuario actual:</strong> <?php echo htmlspecialchars($_SESSION['username']); ?> 
               <span class="admin-badge">ADMIN</span>
            </p>
            <p><strong>Sesi√≥n activa desde:</strong> <?php echo date('H:i:s'); ?></p>
            <p><small>Todas las acciones quedan registradas en el sistema.</small></p>
        </div>
    </div>
    
    <script>
        console.log("üö® PANEL DE ADMINISTRACI√ìN ACTIVO");
        console.log("=================================");
        console.log("Usuario: <?php echo htmlspecialchars($_SESSION['username']); ?>");
        console.log("Nivel de acceso: ADMINISTRADOR");
        console.log("IP: <?php echo $_SERVER['REMOTE_ADDR']; ?>");
        console.log("Hora de acceso: <?php echo date('Y-m-d H:i:s'); ?>");
        console.log("=================================");
        console.log("Advertencia: Esta √°rea contiene funciones cr√≠ticas del sistema.");
        console.log("Todas las acciones son monitoreadas y registradas.");
        
        // Protecci√≥n adicional
        document.addEventListener('contextmenu', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            e.preventDefault();
        });
        
        // Prevenir F12
        document.onkeydown = function(e) {
            if (e.key === 'F12') {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                return false;
            }
            if (e.ctrlKey && e.key === 'U') {
                return false;
            }
        };
    </script>
</body>
</html>
    <?php
}
?>
