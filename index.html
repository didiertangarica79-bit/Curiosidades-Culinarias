{
  "sistema": "BookSales Live Tracker v3.0",
  "version": "1.0.0",
  "descripcion": "Sistema completo de seguimiento en tiempo real de ventas de libros con estadÃ­sticas, promociones y notificaciones",
  "ultima_actualizacion": "2025-12-21",
  
  "configuracion_principal": {
    "modo": "tiempo_real",
    "idioma": "es",
    "moneda": "USD",
    "zona_horaria": "America/Mexico_City",
    "url_panel": "https://panel.tusitio.com/admin",
    "url_publico": "https://tusitio.com/estadisticas",
    "acceso_publico": {
      "ver_estadisticas": true,
      "ver_contador": true,
      "ver_reloj": true,
      "comprar_libros": true
    }
  },
  
  "modulos_activos": {
    "ventas_tiempo_real": true,
    "estadisticas_completas": true,
    "sistema_rifas": true,
    "notificaciones": true,
    "panel_administracion": true,
    "integracion_redes": true,
    "seguimiento_envios": false
  },
  
  "estadisticas_visualizacion": {
    "para_publico": ["libros_vendidos_hoy", "libros_vendidos_total", "contador_promocion"],
    "para_admin": {
      "detalles_ventas": {
        "mostrar_cliente": true,
        "mostrar_email": true,
        "mostrar_telefono": false,
        "mostrar_direccion": false,
        "mostrar_precio": true,
        "mostrar_libro": true,
        "mostrar_fecha": true,
        "mostrar_ubicacion": true,
        "mostrar_metodo_pago": true
      },
      "reportes_automaticos": {
        "diario": true,
        "semanal": true,
        "mensual": true,
        "por_libro": true,
        "por_cliente": true,
        "por_ubicacion": true
      }
    }
  },
  
  "rifas_promociones": {
    "modo_rifa_negativa": {
      "activado": true,
      "formato": "dias_restantes",
      "mostrar_en": ["panel_admin", "sitio_web", "redes_sociales"],
      "colores": {
        "mas_5_dias": "#4CAF50",
        "3_a_5_dias": "#FF9800",
        "1_a_2_dias": "#FF5722",
        "ultimo_dia": "#F44336"
      }
    },
    "reloj_promocion": {
      "activado": true,
      "mostrar_inicio": true,
      "mostrar_fin": true,
      "alertas_sonoras": {
        "inicio_promocion": true,
        "fin_promocion": true,
        "24_horas_antes": true,
        "1_hora_antes": true
      },
      "mensajes": {
        "inicio": "Â¡La promociÃ³n ha comenzado!",
        "fin": "Â¡La promociÃ³n ha finalizado!",
        "contador": "Tiempo restante para la rifa:"
      }
    }
  },
  
  "notificaciones_automaticas": {
    "para_cliente": {
      "confirmacion_pedido": {
        "activado": true,
        "metodos": ["email", "whatsapp"],
        "mensaje_email": "Gracias por tu compra. Hemos recibido tu pedido del libro: [LIBRO]",
        "mensaje_whatsapp": "âœ… Pedido confirmado. Libro: [LIBRO]. Precio: [PRECIO]"
      },
      "confirmacion_pago": {
        "activado": true,
        "metodos": ["email"],
        "mensaje": "âœ… Pago verificado. Tu libro serÃ¡ procesado en 24-48 horas."
      },
      "recordatorio_rifa": {
        "activado": true,
        "dias_antes": [3, 1],
        "mensaje": "â° Recordatorio: La rifa cierra en [DIAS] dÃ­as. Â¡No te quedes fuera!"
      }
    },
    
    "para_admin": {
      "nueva_venta": {
        "activado": true,
        "metodos": ["email", "whatsapp", "notificacion_panel"],
        "mensaje": "ðŸ›’ NUEVA VENTA: [LIBRO] por [PRECIO] a [CLIENTE] - [FECHA]",
        "datos_incluir": ["libro", "precio", "cliente", "fecha", "ubicacion", "metodo_pago"]
      },
      "pago_verificado": {
        "activado": true,
        "metodos": ["notificacion_panel"],
        "mensaje": "ðŸ’° Pago verificado: Pedido #[ID_PEDIDO]"
      },
      "alerta_rifa": {
        "activado": true,
        "metodos": ["email"],
        "24_horas_antes": true,
        "1_hora_antes": true,
        "finalizada": true
      }
    }
  },
  
  "integraciones": {
    "pasarelas_pago": {
      "paypal": {
        "activado": true,
        "modo": "sandbox",
        "webhooks": ["payment.completed", "payment.captured"]
      },
      "stripe": {
        "activado": false,
        "modo": "test"
      },
      "mercado_pago": {
        "activado": true,
        "modo": "production"
      }
    },
    
    "redes_sociales": {
      "autopublicacion": {
        "activado": true,
        "plataformas": ["facebook", "twitter", "instagram"],
        "eventos_publicar": ["nueva_venta", "inicio_rifa", "fin_rifa", "meta_alcanzada"]
      },
      "api_keys": {
        "facebook": "FB_APP_ID",
        "twitter": "TWITTER_BEARER_TOKEN",
        "instagram": "IG_ACCESS_TOKEN"
      }
    },
    
    "email": {
      "servicio": "sendgrid",
      "api_key": "SENDGRID_API_KEY",
      "plantillas": {
        "confirmacion_compra": "template_confirmation_id",
        "notificacion_admin": "template_admin_notification_id"
      }
    },
    
    "whatsapp": {
      "servicio": "twilio",
      "account_sid": "TWILIO_ACCOUNT_SID",
      "auth_token": "TWILIO_AUTH_TOKEN",
      "numero_whatsapp": "+1234567890"
    }
  },
  
  "base_datos": {
    "tipo": "firebase_realtime",
    "estructura": {
      "ventas": {
        "id_venta": "string",
        "id_libro": "string",
        "titulo_libro": "string",
        "precio": "number",
        "cliente": {
          "nombre": "string",
          "email": "string",
          "telefono": "string"
        },
        "fecha_venta": "timestamp",
        "ubicacion": {
          "pais": "string",
          "ciudad": "string"
        },
        "metodo_pago": "string",
        "estado_pago": ["pendiente", "completado", "fallido"],
        "notificado": "boolean"
      },
      "libros": {
        "id_libro": "string",
        "titulo": "string",
        "autor": "string",
        "precio": "number",
        "stock": "number",
        "categorias": "array",
        "descripcion": "string"
      },
      "rifas": {
        "id_rifa": "string",
        "nombre": "string",
        "fecha_inicio": "timestamp",
        "fecha_fin": "timestamp",
        "premio": "string",
        "participantes": "array",
        "estado": ["activa", "finalizada", "pendiente"]
      },
      "configuracion": {
        "contadores": "object",
        "estadisticas_diarias": "object",
        "alertas_programadas": "array"
      }
    }
  },
  
  "frontend_config": {
    "panel_publico": {
      "diseno": "moderno_oscuro",
      "elementos": [
        {
          "nombre": "contador_ventas",
          "tipo": "contador_live",
          "posicion": "top_center",
          "actualizacion": "5_seconds"
        },
        {
          "nombre": "reloj_promocion",
          "tipo": "reloj_cuenta_regresiva",
          "posicion": "top_right",
          "formato": "DD:HH:MM:SS"
        },
        {
          "nombre": "ultimas_ventas",
          "tipo": "lista_tiempo_real",
          "posicion": "centro",
          "mostrar": 5,
          "campos": ["libro", "hace", "ubicacion"]
        },
        {
          "nombre": "estadisticas_grafico",
          "tipo": "grafico_barras",
          "posicion": "bottom_left",
          "datos": ["ventas_hoy", "ventas_semana", "libro_mas_vendido"]
        }
      ],
      "animaciones": {
        "nueva_venta": "flash_verde",
        "actualizacion": "fade_in",
        "alerta_promocion": "parpadeo_naranja"
      }
    },
    
    "panel_admin": {
      "diseno": "profesional_claro",
      "vistas": ["dashboard", "ventas", "libros", "rifas", "clientes", "reportes"],
      "acceso": "password_protegido",
      "permisos": {
        "ver_todo": true,
        "editar_libros": true,
        "crear_rifas": true,
        "exportar_datos": true,
        "configurar_sistema": true
      }
    }
  },
  
  "seguridad": {
    "autenticacion": {
      "admin": "usuario_password",
      "api_keys": "encriptadas",
      "webhooks": "firmados"
    },
    "ssl": true,
    "backup_automatico": {
      "frecuencia": "diario",
      "retencion": "30_dias",
      "ubicacion": "cloud_storage"
    }
  },
  
  "cron_jobs": {
    "tareas_automaticas": [
      {
        "nombre": "actualizar_contadores",
        "frecuencia": "cada_5_segundos",
        "accion": "actualizar_estadisticas_tiempo_real"
      },
      {
        "nombre": "verificar_pagos_pendientes",
        "frecuencia": "cada_hora",
        "accion": "revisar_estados_pago"
      },
      {
        "nombre": "enviar_notificaciones_rifa",
        "frecuencia": "cada_dia_09:00",
        "accion": "enviar_recordatorios_rifa"
      },
      {
        "nombre": "generar_reportes_diarios",
        "frecuencia": "cada_dia_23:59",
        "accion": "crear_reporte_ventas_diario"
      },
      {
        "nombre": "backup_base_datos",
        "frecuencia": "cada_dia_02:00",
        "accion": "respaldar_toda_informacion"
      }
    ]
  },
  
  "configuracion_despliegue": {
    "servidor": {
      "tipo": "nodejs",
      "version": "18.x",
      "puerto": 3000,
      "entorno": "production"
    },
    "hosting": "vercel",
    "dominio": "tudominio.com",
    "ssl": "letsencrypt",
    "monitoreo": {
      "uptime": true,
      "errores": true,
      "rendimiento": true
    }
  },
  
  "instrucciones_implementacion": [
    "1. Crear cuenta en Firebase y configurar base de datos en tiempo real",
    "2. Configurar cuentas en SendGrid (email) y Twilio (WhatsApp)",
    "3. Configurar pasarelas de pago (PayPal, Mercado Pago)",
    "4. Desplegar frontend en Vercel/Netlify",
    "5. Desplegar backend en servidor Node.js",
    "6. Configurar dominios y SSL",
    "7. Probar flujo completo de compra",
    "8. Activar monitoreo y alertas"
  ],
  
  "variables_entorno": {
    "FIREBASE_API_KEY": "tu_api_key_firebase",
    "FIREBASE_DATABASE_URL": "https://tu-proyecto.firebaseio.com",
    "SENDGRID_API_KEY": "tu_sendgrid_key",
    "TWILIO_ACCOUNT_SID": "tu_twilio_sid",
    "TWILIO_AUTH_TOKEN": "tu_twilio_token",
    "PAYPAL_CLIENT_ID": "tu_paypal_id",
    "PAYPAL_SECRET": "tu_paypal_secret",
    "MERCADOPAGO_ACCESS_TOKEN": "tu_mp_token",
    "ADMIN_PASSWORD": "contraseÃ±a_segura_admin",
    "JWT_SECRET": "secreto_jwt_para_auth"
  }
}
{
  "name": "book-sales-tracker",
  "version": "1.0.0",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.0",
    "socket.io": "^4.5.0",
    "firebase-admin": "^11.0.0",
    "@sendgrid/mail": "^7.7.0",
    "twilio": "^3.80.0",
    "cors": "^2.8.5",
    "dotenv": "^16.0.0"
  }
}
FIREBASE_API_KEY=tu_api_key_aqui
FIREBASE_DATABASE_URL=https://tu-proyecto.firebaseio.com
SENDGRID_API_KEY=SG.tu_key_aqui
TWILIO_ACCOUNT_SID=ACtu_sid_aqui
TWILIO_AUTH_TOKEN=tu_token_aqui
PAYPAL_CLIENT_ID=tu_client_id
MERCADOPAGO_ACCESS_TOKEN=APP_USR-tu_token
ADMIN_PASSWORD=contraseÃ±aSegura123
JWT_SECRET=miSecretoSuperSeguroJWT
PORT=3000
NODE_ENV=production
const express = require('express');
const socketIO = require('socket.io');
const admin = require('firebase-admin');
require('dotenv').config();

const app = express();
const server = require('http').createServer(app);
const io = socketIO(server, { cors: { origin: '*' } });

// Inicializar Firebase
const serviceAccount = require('./firebase-key.json');
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: process.env.FIREBASE_DATABASE_URL
});
const db = admin.database();

// ConfiguraciÃ³n bÃ¡sica
app.use(express.json());
app.use(cors());

// Rutas principales
app.post('/api/venta', registrarVenta);
app.get('/api/estadisticas', obtenerEstadisticas);
app.post('/api/rifa', crearRifa);
app.get('/api/tiempo-real', socketConection);

// ConfiguraciÃ³n Socket.io para tiempo real
io.on('connection', (socket) => {
  console.log('Cliente conectado');
  
  // Escuchar nuevas ventas
  socket.on('nueva_venta', (venta) => {
    io.emit('actualizar_ventas', venta);
  });
  
  // Enviar contador de rifa
  setInterval(() => {
    const tiempoRestante = calcularTiempoRifa();
    socket.emit('actualizar_contador', tiempoRestante);
  }, 1000);
});

// Funciones principales
async function registrarVenta(req, res) {
  const venta = req.body;
  const ventaRef = db.ref('ventas').push();
  
  await ventaRef.set({
    ...venta,
    fecha: Date.now(),
    estado: 'completado'
  });
  
  // Notificar a todos los clientes conectados
  io.emit('nueva_venta', venta);
  
  // Enviar notificaciones
  enviarNotificacionCliente(venta);
  enviarNotificacionAdmin(venta);
  
  res.json({ success: true, id: ventaRef.key });
}

function calcularTiempoRifa() {
  // LÃ³gica para calcular dÃ­as restantes
  const fechaFin = new Date('2025-12-31');
  const ahora = new Date();
  const diferencia = fechaFin - ahora;
  
  return {
    dias: Math.floor(diferencia / (1000 * 60 * 60 * 24)),
    horas: Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
    minutos: Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60)),
    segundos: Math.floor((diferencia % (1000 * 60)) / 1000)
  };
}

server.listen(process.env.PORT || 3000, () => {
  console.log(`Servidor corriendo en puerto ${process.env.PORT}`);
});
