<?php
session_start();
require_once 'config/database.php';

// Verificar si es admin
$is_admin = isset($_SESSION['es_admin']) && $_SESSION['es_admin'] == 1;

// Inicializar variables de configuración
$configuracion = [];
$eventos = [];
$compras = [];

// Cargar configuración desde la base de datos
try {
    $stmt = $pdo->query("SELECT * FROM configuracion LIMIT 1");
    $configuracion = $stmt->fetch(PDO::FETCH_ASSOC);
} catch (Exception $e) {
    // Configuración por defecto si no existe
    $configuracion = [
        'titulo_sorteo' => 'Sorteo Especial',
        'fecha_sorteo' => date('Y-m-d', strtotime('+30 days')),
        'hora_sorteo' => '20:00',
        'precio_boleto' => 10.00,
        'premio_principal' => 5000.00,
        'estado' => 'activo'
    ];
}

// Cargar eventos
try {
    $stmt = $pdo->query("SELECT * FROM eventos WHERE fecha >= CURDATE() ORDER BY fecha ASC");
    $eventos = $stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (Exception $e) {
    $eventos = [];
}

// Cargar compras del usuario si está logueado
if (isset($_SESSION['usuario_id'])) {
    try {
        $stmt = $pdo->prepare("SELECT * FROM compras WHERE usuario_id = ? ORDER BY fecha_compra DESC");
        $stmt->execute([$_SESSION['usuario_id']]);
        $compras = $stmt->fetchAll(PDO::FETCH_ASSOC);
    } catch (Exception $e) {
        $compras = [];
    }
}

// Obtener mes y año actual
$mes_actual = date('n');
$ano_actual = date('Y');
$hoy = date('j');

// Fechas conmemorativas por mes
$fechas_conmemorativas = [
    1 => [ // Enero
        1 => 'Año Nuevo',
        6 => 'Día de Reyes',
        28 => 'Natalicio de José Martí'
    ],
    2 => [ // Febrero
        14 => 'Día de San Valentín',
        24 => 'Día del Trabajador de la Radio y la Televisión'
    ],
    3 => [ // Marzo
        8 => 'Día Internacional de la Mujer',
        13 => 'Aniversario del Asalto al Palacio Presidencial'
    ],
    4 => [ // Abril
        19 => 'Victoria de Playa Girón'
    ],
    5 => [ // Mayo
        1 => 'Día Internacional de los Trabajadores',
        17 => 'Día del Campesino'
    ],
    6 => [ // Junio
        14 => 'Día de los Trabajadores del Comercio'
    ],
    7 => [ // Julio
        26 => 'Día de la Rebeldía Nacional',
        30 => 'Día de los Mártires de la Revolución'
    ],
    8 => [ // Agosto
        13 => 'Cumpleaños de Fidel Castro'
    ],
    9 => [ // Septiembre
        28 => 'Día del Comité de Defensa de la Revolución (CDR)'
    ],
    10 => [ // Octubre
        8 => 'Aniversario de la Muerte del Che Guevara',
        28 => 'Día de la Prensa Cubana'
    ],
    11 => [ // Noviembre
        27 => 'Fusilamiento de los Estudiantes de Medicina'
    ],
    12 => [ // Diciembre
        7 => 'Día de las Madres',
        25 => 'Navidad'
    ]
];

// Obtener días del mes
$dias_mes = cal_days_in_month(CAL_GREGORIAN, $mes_actual, $ano_actual);
$primer_dia = date('N', strtotime("$ano_actual-$mes_actual-01"));

// Nombres de meses
$nombres_meses = [
    1 => 'Enero', 2 => 'Febrero', 3 => 'Marzo', 4 => 'Abril',
    5 => 'Mayo', 6 => 'Junio', 7 => 'Julio', 8 => 'Agosto',
    9 => 'Septiembre', 10 => 'Octubre', 11 => 'Noviembre', 12 => 'Diciembre'
];

// Nombres de días
$nombres_dias = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'];
?>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Rifas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
        }

        .logo h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .menu {
            list-style: none;
        }

        .menu-item {
            margin-bottom: 10px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .menu-link:hover, .menu-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateX(5px);
        }

        .menu-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .admin-only {
            border-left: 4px solid #ff6b6b;
            background: #fff5f5;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Carpetas con portadas */
        .carpetas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .carpeta {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .carpeta:hover {
            transform: translateY(-5px);
        }

        .portada {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .portada-sorteo { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .portada-eventos { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); }
        .portada-compras { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
        .portada-resultados { background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); }

        .carpeta-info {
            padding: 15px;
        }

        .carpeta-info h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .carpeta-info p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Calendario */
        .calendario-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .calendario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .mes-ano {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .dias-semana {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .dia-semana {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            padding: 10px;
        }

        .dias-mes {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .dia {
            text-align: center;
            padding: 15px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dia:hover {
            background: #667eea;
            color: white;
        }

        .dia.actual {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .dia.conmemorativo {
            background: #ff6b6b;
            color: white;
            position: relative;
        }

        .dia.conmemorativo::after {
            content: '★';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

        .eventos-hoy {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Relojes */
        .relojes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .reloj {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .reloj h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .hora {
            font-size: 2.5rem;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .fecha {
            margin-top: 10px;
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Estadísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        /* Carrito de compras */
        .carrito-icon {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .carrito-icon:hover {
            transform: scale(1.1);
        }

        .carrito-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff6b6b;
            color: white;
            font-size: 0.8rem;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Configuración solo para admin */
        .config-section {
            display: <?php echo $is_admin ? 'block' : 'none'; ?>;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Alertas */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-top: 20px;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area i {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .uploaded-files {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .file-icon {
            margin-right: 10px;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-gift"></i> Sistema de Rifas</h1>
                <p>¡Gana grandes premios!</p>
            </div>
            
            <ul class="menu">
                <li class="menu-item">
                    <a href="index.php" class="menu-link active">
                        <i class="fas fa-home menu-icon"></i>
                        Inicio
                    </a>
                </li>
                <li class="menu-item">
                    <a href="sorteos.php" class="menu-link">
                        <i class="fas fa-ticket-alt menu-icon"></i>
                        Sorteos Activos
                    </a>
                </li>
                <li class="menu-item">
                    <a href="eventos.php" class="menu-link">
                        <i class="fas fa-calendar-alt menu-icon"></i>
                        Eventos
                    </a>
                </li>
                <li class="menu-item">
                    <a href="compras.php" class="menu-link">
                        <i class="fas fa-shopping-cart menu-icon"></i>
                        Mis Compras
                    </a>
                </li>
                <li class="menu-item">
                    <a href="resultados.php" class="menu-link">
                        <i class="fas fa-trophy menu-icon"></i>
                        Resultados
                    </a>
                </li>
                
                <?php if($is_admin): ?>
                <li class="menu-item">
                    <a href="configuracion.php" class="menu-link admin-only">
                        <i class="fas fa-cog menu-icon"></i>
                        Configuración
                    </a>
                </li>
                <li class="menu-item">
                    <a href="admin_eventos.php" class="menu-link admin-only">
                        <i class="fas fa-calendar-plus menu-icon"></i>
                        Administrar Eventos
                    </a>
                </li>
                <li class="menu-item">
                    <a href="reportes.php" class="menu-link admin-only">
                        <i class="fas fa-chart-bar menu-icon"></i>
                        Reportes
                    </a>
                </li>
                <?php endif; ?>
            </ul>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-area">
                <div class="section-title">
                    <h2><i class="fas fa-home"></i> Panel Principal</h2>
                    <span class="badge">Usuario: <?php echo isset($_SESSION['usuario']) ? $_SESSION['usuario'] : 'Invitado'; ?></span>
                </div>

                <!-- Carpetas con Portadas -->
                <h3><i class="fas fa-folder"></i> Mis Carpetas</h3>
                <div class="carpetas-grid">
                    <div class="carpeta" onclick="location.href='sorteos.php'">
                        <div class="portada portada-sorteo">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="carpeta-info">
                            <h3>Sorteos</h3>
                            <p>Participa en nuestros sorteos activos</p>
                        </div>
                    </div>

                    <div class="carpeta" onclick="location.href='eventos.php'">
                        <div class="portada portada-eventos">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="carpeta-info">
                            <h3>Eventos</h3>
                            <p>Próximos eventos y actividades</p>
                        </div>
                    </div>

                    <div class="carpeta" onclick="location.href='compras.php'">
                        <div class="portada portada-compras">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="carpeta-info">
                            <h3>Compras</h3>
                            <p>Historial de tus compras</p>
                        </div>
                    </div>

                    <div class="carpeta" onclick="location.href='resultados.php'">
                        <div class="portada portada-resultados">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="carpeta-info">
                            <h3>Resultados</h3>
                            <p>Ganadores de sorteos anteriores</p>
                        </div>
                    </div>
                </div>

                <!-- Relojes -->
                <div class="relojes-container">
                    <div class="reloj">
                        <h3><i class="fas fa-clock"></i> Hora del Sorteo</h3>
                        <div class="hora" id="reloj-sorteo">--:--:--</div>
                        <div class="fecha">Próximo sorteo: <?php echo date('d/m/Y', strtotime($configuracion['fecha_sorteo'])); ?></div>
                    </div>

                    <div class="reloj">
                        <h3><i class="fas fa-globe-americas"></i> Hora de Cuba</h3>
                        <div class="hora" id="reloj-cuba">--:--</div>
                        <div class="fecha"><?php echo date('d/m/Y'); ?></div>
                    </div>
                </div>

                <!-- Estadísticas -->
                <h3><i class="fas fa-chart-line"></i> Estadísticas</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Boletos Vendidos</h3>
                        <div class="stat-number">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recaudación Total</h3>
                        <div class="stat-number">$0.00</div>
                    </div>
                    <div class="stat-card">
                        <h3>Usuarios Registrados</h3>
                        <div class="stat-number">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Premios Entregados</h3>
                        <div class="stat-number">0</div>
                    </div>
                </div>

                <!-- Configuración (solo visible para admin) -->
                <?php if($is_admin): ?>
                <div class="config-section">
                    <h3><i class="fas fa-cog"></i> Configuración del Sistema</h3>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Arrastra y suelta archivos aquí</h4>
                        <p>o haz clic para seleccionar</p>
                        <input type="file" id="fileInput" style="display: none;" multiple>
                    </div>
                    <div id="uploadedFiles" class="uploaded-files"></div>
                </div>
                <?php endif; ?>
            </div>

            <!-- Sidebar Derecha - Calendario -->
            <div class="sidebar">
                <!-- Calendario -->
                <div class="calendario-container">
                    <div class="calendario-header">
                        <div class="mes-ano">
                            <?php echo $nombres_meses[$mes_actual] . ' ' . $ano_actual; ?>
                        </div>
                        <div>
                            <button class="btn" onclick="cambiarMes(-1)"><i class="fas fa-chevron-left"></i></button>
                            <button class="btn" onclick="cambiarMes(1)"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>

                    <div class="dias-semana">
                        <?php foreach($nombres_dias as $dia): ?>
                            <div class="dia-semana"><?php echo $dia; ?></div>
                        <?php endforeach; ?>
                    </div>

                    <div class="dias-mes">
                        <?php for($i = 1; $i < $primer_dia; $i++): ?>
                            <div class="dia"></div>
                        <?php endfor; ?>

                        <?php for($dia = 1; $dia <= $dias_mes; $dia++): ?>
                            <?php
                            $es_hoy = ($dia == $hoy);
                            $es_conmemorativo = isset($fechas_conmemorativas[$mes_actual][$dia]);
                            $clases = 'dia';
                            if($es_hoy) $clases .= ' actual';
                            if($es_conmemorativo) $clases .= ' conmemorativo';
                            ?>
                            <div class="<?php echo $clases; ?>" title="<?php echo $es_conmemorativo ? $fechas_conmemorativas[$mes_actual][$dia] : ''; ?>">
                                <?php echo $dia; ?>
                            </div>
                        <?php endfor; ?>
                    </div>

                    <!-- Eventos del día -->
                    <div class="eventos-hoy">
                        <h4><i class="fas fa-star"></i> Eventos de Hoy</h4>
                        <?php
                        $eventos_hoy = array_filter($eventos, function($evento) {
                            return $evento['fecha'] == date('Y-m-d');
                        });
                        
                        if(count($eventos_hoy) > 0): 
                            foreach($eventos_hoy as $evento): ?>
                                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                                    <strong><?php echo $evento['titulo']; ?></strong>
                                    <p style="margin: 5px 0; font-size: 0.9rem;"><?php echo $evento['descripcion']; ?></p>
                                    <small><?php echo date('H:i', strtotime($evento['hora'])); ?></small>
                                </div>
                            <?php endforeach; 
                        else: ?>
                            <p style="text-align: center; color: #666; margin-top: 10px;">
                                No hay eventos programados para hoy.
                            </p>
                        <?php endif; ?>
                    </div>
                </div>

                <!-- Fechas Conmemorativas del Mes -->
                <div class="calendario-container">
                    <h4><i class="fas fa-calendar-star"></i> Fechas Conmemorativas</h4>
                    <div style="margin-top: 15px;">
                        <?php if(isset($fechas_conmemorativas[$mes_actual])): 
                            foreach($fechas_conmemorativas[$mes_actual] as $dia => $evento): ?>
                                <div style="padding: 8px 0; border-bottom: 1px solid #eee;">
                                    <strong><?php echo $dia . ' de ' . $nombres_meses[$mes_actual]; ?>:</strong>
                                    <span><?php echo $evento; ?></span>
                                </div>
                            <?php endforeach; 
                        else: ?>
                            <p style="text-align: center; color: #666; padding: 15px 0;">
                                No hay fechas conmemorativas este mes.
                            </p>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Carrito de Compras Flotante -->
    <div class="carrito-icon" onclick="location.href='compras.php'">
        <i class="fas fa-shopping-cart"></i>
        <div class="carrito-badge">0</div>
    </div>

    <script>
        // Reloj del Sorteo
        function actualizarRelojSorteo() {
            const ahora = new Date();
            const hora = ahora.getHours().toString().padStart(2, '0');
            const minutos = ahora.getMinutes().toString().padStart(2, '0');
            const segundos = ahora.getSeconds().toString().padStart(2, '0');
            document.getElementById('reloj-sorteo').textContent = `${hora}:${minutos}:${segundos}`;
        }

        // Reloj de Cuba (hora corta)
        function actualizarRelojCuba() {
            const ahora = new Date();
            // Cuba está en UTC-5 (pero puede variar por horario de verano)
            // Para simplificar, mostramos la hora local con formato corto
            const hora = ahora.getHours().toString().padStart(2, '0');
            const minutos = ahora.getMinutes().toString().padStart(2, '0');
            document.getElementById('reloj-cuba').textContent = `${hora}:${minutos}`;
        }

        // Actualizar relojes cada segundo
        setInterval(() => {
            actualizarRelojSorteo();
            actualizarRelojCuba();
        }, 1000);

        // Inicializar relojes
        actualizarRelojSorteo();
        actualizarRelojCuba();

        // Manejo de subida de archivos
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const uploadedFiles = document.getElementById('uploadedFiles');

            <?php if($is_admin): ?>
            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(102, 126, 234, 0.2)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
                const files = e.dataTransfer.files;
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            function handleFiles(files) {
                if (!files.length) return;
                
                // Mostrar archivos subidos
                for (let file of files) {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <i class="fas fa-file ${getFileIcon(file.type)} file-icon"></i>
                        <div>
                            <strong>${file.name}</strong>
                            <p>${(file.size / 1024).toFixed(2)} KB</p>
                        </div>
                    `;
                    uploadedFiles.appendChild(fileItem);
                }

                // Mostrar mensaje de éxito
                showAlert('Archivos subidos correctamente', 'success');
                
                // Aquí iría la lógica para subir los archivos al servidor
                // usando FormData y fetch
            }

            function getFileIcon(type) {
                if (type.startsWith('image/')) return 'fa-file-image';
                if (type.includes('pdf')) return 'fa-file-pdf';
                if (type.includes('word')) return 'fa-file-word';
                if (type.includes('excel')) return 'fa-file-excel';
                return 'fa-file';
            }
            <?php endif; ?>
        });

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            const contentArea = document.querySelector('.content-area');
            contentArea.insertBefore(alert, contentArea.firstChild);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function cambiarMes(direccion) {
            // Aquí iría la lógica para cambiar de mes
            alert('Función para cambiar de mes - Se implementará con AJAX');
        }
    </script>
</body>
</html>
