<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curiosidades Culinarias - Sistema Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
    <style>
        :root {
            --color-bg: #0f172a;
            --color-card: #1e293b;
            --color-primary: #3b82f6;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-text: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--color-bg); 
            color: var(--color-text);
            min-height: 100vh;
        }
        /* MODOS DE VISUALIZACI√ìN */
        #publicView, #adminView { display: none; }
        #publicView.active, #adminView.active { display: block; }
        
        /* PANEL P√öBLICO */
        .public-container { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: var(--color-card); border-radius: 15px; }
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .card { 
            background: var(--color-card); 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-left: 5px solid var(--color-primary);
        }
        .stat-number { 
            font-size: 3.5rem; 
            font-weight: bold; 
            color: var(--color-success); 
            text-align: center;
            margin: 15px 0;
        }
        .countdown { 
            font-size: 2.2rem; 
            font-weight: bold; 
            text-align: center; 
            color: var(--color-warning);
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .live-sales-list { max-height: 400px; overflow-y: auto; }
        .sale-item { 
            background: rgba(30, 41, 59, 0.7); 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 10px;
            border-left: 4px solid var(--color-success);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sale-item.new { animation: highlight 2s; }
        @keyframes highlight {
            0% { background: rgba(16, 185, 129, 0.3); }
            100% { background: rgba(30, 41, 59, 0.7); }
        }
        
        /* PANEL ADMIN */
        .admin-container { display: flex; min-height: 100vh; }
        .sidebar { 
            width: 280px; 
            background: #1a2238; 
            padding: 25px 20px;
            border-right: 2px solid var(--color-primary);
        }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .menu-item {
            padding: 15px;
            margin: 10px 0;
            background: #252f4a;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }
        .menu-item:hover, .menu-item.active {
            background: var(--color-primary);
            transform: translateX(5px);
        }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 25px 0; }
        .admin-table {
            width: 100%;
            background: var(--color-card);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .admin-table th, .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        .admin-table th { background: #252f4a; }
        .btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-success { background: var(--color-success); }
        .btn-danger { background: var(--color-danger); }
        .btn-warning { background: var(--color-warning); }
        
        /* LOGIN */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--color-bg);
        }
        .login-box {
            background: var(--color-card);
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 8px; color: #94a3b8; }
        .input-group input {
            width: 100%;
            padding: 15px;
            background: #252f4a;
            border: 2px solid #334155;
            border-radius: 10px;
            color: white;
            font-size: 16px;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        
        /* CONFIG VISOR */
        .config-viewer {
            background: #0d1525;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .config-key { color: #60a5fa; }
        .config-value { color: #34d399; }
        .config-string { color: #fbbf24; }
        
        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .admin-container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1 style="text-align: center; margin-bottom: 30px; color: var(--color-primary);">
                <i class="fas fa-lock"></i> Acceso Administrador
            </h1>
            <div class="input-group">
                <label><i class="fas fa-user"></i> Usuario</label>
                <input type="text" id="adminUser" placeholder="admin">
            </div>
            <div class="input-group">
                <label><i class="fas fa-key"></i> Contrase√±a</label>
                <input type="password" id="adminPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn" style="width: 100%;" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Ingresar al Sistema
            </button>
            <p style="text-align: center; margin-top: 20px; color: #94a3b8;">
                <a href="#" style="color: var(--color-primary);" onclick="showPublicView()">
                    <i class="fas fa-eye"></i> Ver Panel P√∫blico
                </a>
            </p>
        </div>
    </div>

    <!-- VISTA P√öBLICA -->
    <div id="publicView">
        <div class="public-container">
            <div class="header">
                <h1><i class="fas fa-book-open"></i> CURIOSIDADES CULINARIAS</h1>
                <p>Sistema de Seguimiento de Ventas en Tiempo Real</p>
                <button class="btn" onclick="showLogin()" style="margin-top: 15px;">
                    <i class="fas fa-user-cog"></i> Acceso Admin
                </button>
            </div>

            <div class="dashboard-grid">
                <!-- CONTADOR DE VENTAS -->
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> Ventas Hoy</h2>
                    <div class="stat-number" id="publicSalesToday">0</div>
                    <p style="text-align: center; color: #94a3b8;">Actualizado en vivo cada 5 segundos</p>
                </div>

                <!-- RIFA NEGATIVA -->
                <div class="card">
                    <h2><i class="fas fa-clock"></i> Rifa Activa</h2>
                    <p style="text-align: center; margin-bottom: 10px;">Tiempo restante:</p>
                    <div class="countdown" id="publicRaffleTimer">05:00:00:00</div>
                    <div id="raffleColorBar" style="height: 8px; background: #10b981; border-radius: 4px; margin-top: 15px;"></div>
                </div>

                <!-- LIBRO M√ÅS VENDIDO -->
                <div class="card">
                    <h2><i class="fas fa-crown"></i> Libro del D√≠a</h2>
                    <div class="stat-number" id="publicTopBook">-</div>
                    <p style="text-align: center;" id="publicTopBookSales">Cargando estad√≠sticas...</p>
                </div>

                <!-- RELOJ PROMOCI√ìN -->
                <div class="card">
                    <h2><i class="fas fa-bullhorn"></i> Promoci√≥n Activa</h2>
                    <div class="countdown" id="promotionClock">00:00:00</div>
                    <p style="text-align: center; margin-top: 10px;" id="promotionStatus">
                        <i class="fas fa-circle" style="color: #10b981;"></i> Promoci√≥n en curso
                    </p>
                </div>
            </div>

            <!-- VENTAS EN TIEMPO REAL -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2><i class="fas fa-bolt"></i> √öltimas Ventas (Live)</h2>
                <div class="live-sales-list" id="publicSalesList">
                    <div class="sale-item">
                        <div>
                            <strong>"Secretos de la Cocina Antigua"</strong><br>
                            <small style="color: #94a3b8;">Comprado por: Ana Garc√≠a ‚Ä¢ $29.99 USD</small>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--color-warning);">Ciudad de M√©xico</span><br>
                            <small id="liveTime">Hace 2 minutos</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GR√ÅFICO SIMULADO -->
            <div class="card" style="grid-column: 1 / -1;">
                <h2><i class="fas fa-chart-bar"></i> Estad√≠sticas del D√≠a</h2>
                <div style="display: flex; align-items: flex-end; height: 200px; gap: 15px; padding: 20px; background: rgba(30, 41, 59, 0.5); border-radius: 10px;">
                    <!-- Barras del gr√°fico generadas por JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL ADMINISTRADOR -->
    <div id="adminView" class="admin-container">
        <!-- BARRA LATERAL -->
        <div class="sidebar">
            <h2 style="color: var(--color-primary); margin-bottom: 30px;">
                <i class="fas fa-cogs"></i> Panel Control
            </h2>
            
            <div class="menu-item active" onclick="showAdminSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="menu-item" onclick="showAdminSection('ventas')">
                <i class="fas fa-shopping-cart"></i> Ventas
            </div>
            <div class="menu-item" onclick="showAdminSection('libros')">
                <i class="fas fa-book"></i> Libros
            </div>
            <div class="menu-item" onclick="showAdminSection('rifas')">
                <i class="fas fa-gift"></i> Rifas
            </div>
            <div class="menu-item" onclick="showAdminSection('clientes')">
                <i class="fas fa-users"></i> Clientes
            </div>
            <div class="menu-item" onclick="showAdminSection('notificaciones')">
                <i class="fas fa-bell"></i> Notificaciones
            </div>
            <div class="menu-item" onclick="showAdminSection('config')">
                <i class="fas fa-sliders-h"></i> Configuraci√≥n
            </div>
            <div class="menu-item" onclick="showAdminSection('reportes')">
                <i class="fas fa-file-export"></i> Reportes
            </div>
            
            <div style="margin-top: 50px;">
                <button class="btn btn-warning" onclick="showPublicView()" style="width: 100%; margin-bottom: 10px;">
                    <i class="fas fa-eye"></i> Ver P√∫blico
                </button>
                <button class="btn btn-danger" onclick="logout()" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                </button>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <!-- DASHBOARD ADMIN -->
            <div id="dashboardSection" class="admin-section active">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard Administrativo</h1>
                
                <div class="stats-grid">
                    <div class="card">
                        <h3><i class="fas fa-chart-line"></i> Ventas Hoy</h3>
                        <div class="stat-number" id="adminSalesToday">0</div>
                        <p>Actualizado: <span id="lastUpdate">Ahora</span></p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-money-bill-wave"></i> Ingresos Total</h3>
                        <div class="stat-number" id="adminRevenue">$0 USD</div>
                        <p>Mes actual</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-user-plus"></i> Clientes Nuevos</h3>
                        <div class="stat-number" id="adminNewClients">0</div>
                        <p>√öltimos 7 d√≠as</p>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-clock"></i> Rifa Activa</h3>
                        <div class="countdown" id="adminRaffleTimer">05:00:00:00</div>
                        <p>Participantes: <span id="raffleParticipants">0</span></p>
                    </div>
                </div>

                <!-- TABLA DE VENTAS RECIENTES -->
                <h2 style="margin-top: 30px;"><i class="fas fa-history"></i> Ventas Recientes</h2>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th><th>Cliente</th><th>Libro</th><th>Precio</th><th>Fecha</th><th>Ubicaci√≥n</th><th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="adminSalesTable">
                        <!-- Datos cargados por JavaScript -->
                    </tbody>
                </table>

                <!-- ACCIONES R√ÅPIDAS -->
                <h2 style="margin-top: 30px;"><i class="fas fa-bolt"></i> Acciones R√°pidas</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                    <button class="btn" onclick="simulateSale()">
                        <i class="fas fa-plus"></i> Simular Venta
                    </button>
                    <button class="btn btn-success" onclick="sendTestNotification()">
                        <i class="fas fa-bell"></i> Probar Notificaci√≥n
                    </button>
                    <button class="btn btn-warning" onclick="exportData()">
                        <i class="fas fa-download"></i> Exportar Datos
                    </button>
                    <button class="btn btn-danger" onclick="resetCounters()">
                        <i class="fas fa-redo"></i> Reiniciar Contadores
                    </button>
                </div>
            </div>

            <!-- CONFIGURACI√ìN DEL SISTEMA -->
            <div id="configSection" class="admin-section">
                <h1><i class="fas fa-sliders-h"></i> Configuraci√≥n del Sistema</h1>
                <p>Configuraci√≥n actual basada en tu archivo JSON original:</p>
                
                <div class="config-viewer" id="configViewer">
                    <!-- JSON se mostrar√° aqu√≠ -->
                </div>
                
                <div style="margin-top: 20px;">
                    <h3><i class="fas fa-save"></i> Guardar Configuraci√≥n</h3>
                    <button class="btn" onclick="saveConfig()">
                        <i class="fas fa-cloud-upload-alt"></i> Guardar Cambios
                    </button>
                    <button class="btn btn-warning" onclick="loadDefaultConfig()">
                        <i class="fas fa-undo"></i> Cargar Config Predeterminada
                    </button>
                </div>
            </div>

            <!-- SECCI√ìN RIFAS -->
            <div id="rifasSection" class="admin-section">
                <h1><i class="fas fa-gift"></i> Gesti√≥n de Rifas</h1>
                <div class="card">
                    <h3><i class="fas fa-cog"></i> Configurar Nueva Rifa</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <label>Nombre de la Rifa:</label>
                            <input type="text" id="raffleName" placeholder="Ej: Gran Rifa Navide√±a" style="width: 100%; padding: 10px; margin-top: 5px;">
                        </div>
                        <div>
                            <label>Fecha de Fin:</label>
                            <input type="datetime-local" id="raffleEndDate" style="width: 100%; padding: 10px; margin-top: 5px;">
                        </div>
                    </div>
                    <button class="btn btn-success" style="margin-top: 20px;" onclick="createRaffle()">
                        <i class="fas fa-plus"></i> Crear Rifa
                    </button>
                </div>
            </div>

            <!-- OTRAS SECCIONES (similares) -->
        </div>
    </div>

    <!-- SISTEMA COMPLETO EN UN SOLO ARCHIVO -->
    <script>
        // ================= CONFIGURACI√ìN ORIGINAL =================
        const SYSTEM_CONFIG = {
            sistema: "BookSales Live Tracker v3.0",
            version: "1.0.0",
            descripcion: "Sistema completo de seguimiento en tiempo real de ventas de libros",
            ultima_actualizacion: "2025-12-21",
            configuracion_principal: {
                modo: "tiempo_real",
                idioma: "es",
                moneda: "USD",
                zona_horaria: "America/Mexico_City",
                acceso_publico: {
                    ver_estadisticas: true,
                    ver_contador: true,
                    ver_reloj: true,
                    comprar_libros: true
                }
            },
            modulos_activos: {
                ventas_tiempo_real: true,
                estadisticas_completas: true,
                sistema_rifas: true,
                notificaciones: true,
                panel_administracion: true
            },
            rifas_promociones: {
                modo_rifa_negativa: {
                    activado: true,
                    formato: "dias_restantes",
                    colores: {
                        mas_5_dias: "#10b981",
                        "3_a_5_dias": "#f59e0b",
                        "1_a_2_dias": "#f97316",
                        ultimo_dia: "#ef4444"
                    }
                }
            }
        };

        // ================= VARIABLES GLOBALES =================
        let salesData = [];
        let currentView = 'login';
        let adminLoggedIn = false;
        let salesCounter = 42;
        let revenueCounter = 1250;
        let raffleEndDate = new Date();
        raffleEndDate.setDate(raffleEndDate.getDate() + 5);

        // ================= FUNCIONES DE VISUALIZACI√ìN =================
        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('publicView').classList.remove('active');
            document.getElementById('adminView').classList.remove('active');
            currentView = 'login';
        }

        function showPublicView() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('publicView').classList.add('active');
            document.getElementById('adminView').classList.remove('active');
            currentView = 'public';
            updatePublicView();
        }

        function showAdminView() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('publicView').classList.remove('active');
            document.getElementById('adminView').classList.add('active');
            currentView = 'admin';
            updateAdminView();
        }

        function showAdminSection(sectionId) {
            // Remover active de todos
            document.querySelectorAll('.admin-section').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.menu-item').forEach(el => {
                el.classList.remove('active');
            });
            
            // Activar secci√≥n seleccionada
            document.getElementById(sectionId + 'Section').classList.add('active');
            document.querySelector(`[onclick="showAdminSection('${sectionId}')"]`).classList.add('active');
            
            // Si es configuraci√≥n, mostrar JSON
            if(sectionId === 'config') {
                displayConfigJSON();
            }
        }

        // ================= SISTEMA DE LOGIN =================
        function login() {
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;
            
            if(user === 'admin' && pass === 'admin123') {
                adminLoggedIn = true;
                showAdminView();
                loadInitialData();
            } else {
                alert('Credenciales incorrectas. Usuario: admin / Contrase√±a: admin123');
            }
        }

        function logout() {
            adminLoggedIn = false;
            showLogin();
            document.getElementById('adminPass').value = '';
        }

        // ================= SISTEMA EN TIEMPO REAL =================
        function updatePublicView() {
            // Actualizar contadores
            document.getElementById('publicSalesToday').textContent = salesCounter;
            document.getElementById('publicTopBook').textContent = "Recetas Secretas";
            document.getElementById('publicTopBookSales').textContent = `${Math.floor(salesCounter/3)} vendidos hoy`;
            
            // Actualizar reloj
            updateClock();
            updateRaffleTimer();
            
            // Actualizar lista de ventas
            updateSalesList();
        }

        function updateAdminView() {
            document.getElementById('adminSalesToday').textContent = salesCounter;
            document.getElementById('adminRevenue').textContent = `$${revenueCounter} USD`;
            document.getElementById('adminNewClients').textContent = Math.floor(salesCounter/6);
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            
            updateAdminSalesTable();
            updateRaffleTimer();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('promotionClock').textContent = 
                now.toLocaleTimeString('es-MX', {timeZone: 'America/Mexico_City'});
            
            if(currentView === 'admin') {
                document.getElementById('adminRaffleTimer').textContent = 
                    calculateTimeRemaining(raffleEndDate);
            } else {
                document.getElementById('publicRaffleTimer').textContent = 
                    calculateTimeRemaining(raffleEndDate);
            }
        }

        function updateRaffleTimer() {
            const now = new Date();
            const diff = raffleEndDate - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            // Cambiar color seg√∫n d√≠as restantes
            const colorBar = document.getElementById('raffleColorBar');
            if(colorBar) {
                if(days > 5) colorBar.style.background = SYSTEM_CONFIG.rifas_promociones.modo_rifa_negativa.colores.mas_5_dias;
                else if(days >= 3) colorBar.style.background = SYSTEM_CONFIG.rifas_promociones.modo_rifa_negativa.colores["3_a_5_dias"];
                else if(days >= 1) colorBar.style.background = SYSTEM_CONFIG.rifas_promociones.modo_rifa_negativa.colores["1_a_2_dias"];
                else colorBar.style.background = SYSTEM_CONFIG.rifas_promociones.modo_rifa_negativa.colores.ultimo_dia;
            }
        }

        function calculateTimeRemaining(endDate) {
            const now = new Date();
            const diff = endDate - now;
            
            if(diff <= 0) return "00:00:00:00";
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            return `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ================= SIMULACI√ìN DE VENTAS =================
        function simulateSale() {
            salesCounter++;
            revenueCounter += 25 + Math.floor(Math.random() * 30);
            
            // Agregar venta simulada
            const clients = ["Ana Garc√≠a", "Carlos L√≥pez", "Mar√≠a Rodr√≠guez", "Juan P√©rez", "Laura Mart√≠nez"];
            const books = [
                "Secretos de la Cocina Antigua", 
                "Recetas Veganas Express", 
                "Postres para Principiantes",
                "Cocina Internacional",
                "T√©cnicas Profesionales"
            ];
            const cities = ["CDMX", "Guadalajara", "Monterrey", "Puebla", "Canc√∫n"];
            
            const newSale = {
                id: 'V' + (1000 + salesCounter),
                cliente: clients[Math.floor(Math.random() * clients.length)],
                libro: books[Math.floor(Math.random() * books.length)],
                precio: '$' + (25 + Math.floor(Math.random() * 30)) + ' USD',
                fecha: new Date().toLocaleString('es-MX'),
                ubicacion: cities[Math.floor(Math.random() * cities.length)],
                estado: 'Completado'
            };
            
            salesData.unshift(newSale);
            
            // Actualizar vistas
            updatePublicView();
            updateAdminView();
            
            // Simular notificaci√≥n
            sendNotification('Venta', newSale);
            
            // Efecto visual en panel p√∫blico
            if(currentView === 'public') {
                const salesList = document.getElementById('publicSalesList');
                const saleItem = document.createElement('div');
                saleItem.className = 'sale-item new';
                saleItem.innerHTML = `
                    <div>
                        <strong>"${newSale.libro}"</strong><br>
                        <small style="color: #94a3b8;">Comprado por: ${newSale.cliente} ‚Ä¢ ${newSale.precio}</small>
                    </div>
                    <div style="text-align: right;">
                        <span style="color: var(--color-warning);">${newSale.ubicacion}</span><br>
                        <small>Justo ahora</small>
                    </div>
                `;
                salesList.prepend(saleItem);
                
                // Limitar a 10 items
                if(salesList.children.length > 10) {
                    salesList.removeChild(salesList.lastChild);
                }
            }
        }

        function updateSalesList() {
            // Mantener lista actualizada
        }

        function updateAdminSalesTable() {
            const table = document.getElementById('adminSalesTable');
            if(!table) return;
            
            // Mostrar √∫ltimas 10 ventas
            const recentSales = salesData.slice(0, 10);
            table.innerHTML = recentSales.map(sale => `
                <tr>
                    <td>${sale.id}</td>
                    <td>${sale.cliente}</td>
                    <td>${sale.libro}</td>
                    <td>${sale.precio}</td>
                    <td>${sale.fecha}</td>
                    <td>${sale.ubicacion}</td>
                    <td><span style="color: var(--color-success);">${sale.estado}</span></td>
                </tr>
            `).join('');
        }

        // ================= NOTIFICACIONES =================
        function sendNotification(type, data) {
            console.log(`üìß Notificaci√≥n ${type}:`, data);
            
            // Aqu√≠ ir√≠a la integraci√≥n con SendGrid/Twilio
            if(type === 'Venta') {
                console.log(`üõí NUEVA VENTA: ${data.libro} por ${data.precio} a ${data.cliente} - ${data.fecha}`);
            }
        }

        function sendTestNotification() {
            alert('üìß Notificaci√≥n de prueba enviada\n(En producci√≥n se enviar√≠a por email/WhatsApp)');
        }

        // ================= CONFIGURACI√ìN JSON =================
        function displayConfigJSON() {
            const viewer = document.getElementById('configViewer');
            if(!viewer) return;
            
            viewer.innerHTML = syntaxHighlight(JSON.stringify(SYSTEM_CONFIG, null, 2));
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, 
            function(match) {
                let cls = 'config-value';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'config-key';
                    } else {
                        cls = 'config-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'config-value';
                } else if (/null/.test(match)) {
                    cls = 'config-value';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function saveConfig() {
            alert('‚úÖ Configuraci√≥n guardada correctamente\n(Los cambios se aplicar√°n al sistema)');
        }

        function loadDefaultConfig() {
            if(confirm('¬øCargar configuraci√≥n predeterminada?\nSe perder√°n los cambios no guardados.')) {
                displayConfigJSON();
            }
        }

        // ================= OTRAS FUNCIONES =================
        function exportData() {
            alert('üì• Exportando datos a Excel...\n(En producci√≥n se descargar√≠a el archivo)');
        }

        function resetCounters() {
            if(confirm('¬øReiniciar todos los contadores?\nEsta acci√≥n no se puede deshacer.')) {
                salesCounter = 0;
                revenueCounter = 0;
                salesData = [];
                updatePublicView();
                updateAdminView();
                alert('Contadores reiniciados correctamente');
            }
        }

        function createRaffle() {
            const name = document.getElementById('raffleName').value;
            const date = document.getElementById('raffleEndDate').value;
            
            if(!name || !date) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            raffleEndDate = new Date(date);
            alert(`‚úÖ Rifa "${name}" creada correctamente\nFinaliza el: ${raffleEndDate.toLocaleString()}`);
        }

        function loadInitialData() {
            // Datos iniciales simulados
            for(let i = 0; i < 5; i++) {
                simulateSale();
            }
            salesCounter = 42; // Reset para empezar
            revenueCounter = 1250;
        }

        // ================= INICIALIZACI√ìN =================
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar login inicialmente
            showLogin();
            
            // Configurar intervalos de actualizaci√≥n
            setInterval(updateClock, 1000);
            setInterval(updateRaffleTimer, 60000); // Cada minuto
            
            // Simular ventas autom√°ticas cada 30 segundos
            setInterval(() => {
                if(currentView === 'public' || currentView === 'admin') {
                    simulateSale();
                }
            }, 30000);
            
            // Cargar configuraci√≥n
            displayConfigJSON();
            
            // Datos de ejemplo
            loadInitialData();
        });

        // ================= DATOS DE EJEMPLO =================
        // Ventas iniciales para demo
        salesData = [
            {
                id: 'V1001',
                cliente: 'Ana Garc√≠a',
                libro: 'Secretos de la Cocina Antigua',
                precio: '$29.99 USD',
                fecha: '21/12/2025 14:30',
                ubicacion: 'CDMX',
                estado: 'Completado'
            },
            {
                id: 'V1002',
                cliente: 'Carlos L√≥pez',
                libro: 'Recetas Veganas Express',
                precio: '$24.99 USD',
                fecha: '21/12/2025 13:45',
                ubicacion: 'Guadalajara',
                estado: 'Completado'
            },
            {
                id: 'V1003',
                cliente: 'Mar√≠a Rodr√≠guez',
                libro: 'Postres para Principiantes',
                precio: '$19.99 USD',
                fecha: '21/12/2025 12:15',
                ubicacion: 'Monterrey',
                estado: 'Completado'
            }
        ];
    </script>
</body>
</html>
