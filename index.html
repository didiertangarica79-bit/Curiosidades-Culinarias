<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curiosidades Culinarias - Libros de Cocina en PDF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ESTILOS CSS COMPLETOS (Mismos que en tu c√≥digo original) */
        /* ... (todo el CSS original se mantiene igual) ... */
    </style>
</head>
<body>
    <!-- HTML COMPLETO (Mismo que en tu c√≥digo original) -->
    <!-- ... (todo el HTML original se mantiene igual) ... -->

    <!-- ===== JAVASCRIPT CON LAS MEJORAS SOLICITADAS ===== -->
    <script>
        // ===== CONFIGURACI√ìN MEJORADA =====
        const SYSTEM_CONFIG = {
            folders: {
                pdf: 0,
                images: 0,
                videos: 0,
                total: 0
            },
            stock: {
                "LIB001": 10,
                "LIB002": 8,
                "LIB003": 12
            },
            raffle: {
                name: "SORTEO ESPECIAL!",
                date: "",
                time: "",
                location: "Online, YouTube Live",
                mainPrize: "Libro 'Fusi√≥n Caribe√±a con IA' GRATIS + Acceso a mi tienda online",
                description: "Visita mi nueva tienda online donde encontrar√°s productos exclusivos. Participa en este sorteo para ganar un libro GRATIS y descuentos especiales en tu primera compra."
            },
            whatsapp: "+5352494433",
            raffleDuration: 5 * 24 * 60 * 60 * 1000,
            raffleStartTime: Date.now(),
            
            // NUEVA CONFIGURACI√ìN: CARPETA INICIAL PARA SUBIR ARCHIVOS
            initialUploadFolder: "inicio",
            
            // CONFIGURACI√ìN DE ENV√çO DE ARCHIVOS
            emailService: {
                enabled: true,
                sendMethod: "both", // "email", "whatsapp", "both"
                defaultEmail: "culinariascuriosidades4@gmail.com",
                backupEmail: "didiertangarica79@gmail.com"
            }
        };

        // ===== DATOS DEL SISTEMA =====
        let shoppingCart = [];
        let currentPaymentLocation = null;
        let currentPaymentMethod = null;
        let currentYear = new Date().getFullYear();
        let productStock = JSON.parse(JSON.stringify(SYSTEM_CONFIG.stock));
        
        // ===== SISTEMA DE ARCHIVOS MEJORADO =====
        let uploadedFiles = [];
        let uploadedBooks = [];
        let fileStats = {
            pdf: 0,
            image: 0,
            video: 0,
            audio: 0,
            other: 0,
            total: 0
        };
        
        // ===== NUEVA ESTRUCTURA DE CARPETAS =====
        let fileFolders = {
            inicio: [], // Archivos en la carpeta inicial
            ventas: []  // Archivos asociados a ventas
        };
        
        // ===== SISTEMA DE ENV√çO MEJORADO =====
        let sentFiles = []; // Registro de archivos enviados
        
        // ===== FUNCIONES DE CARPETA INICIAL =====
        function setupInitialFolder() {
            // Crear estructura inicial de carpetas si no existe
            if (!localStorage.getItem('fileFolders')) {
                saveToLocalStorage('fileFolders', fileFolders);
            } else {
                fileFolders = loadFromLocalStorage('fileFolders') || fileFolders;
            }
            
            // Configurar el √°rea de subida para la carpeta "inicio"
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                uploadArea.setAttribute('data-folder', SYSTEM_CONFIG.initialUploadFolder);
            }
        }
        
        function getCurrentUploadFolder() {
            // Retorna la carpeta actual donde se subir√°n los archivos
            const uploadArea = document.getElementById('uploadArea');
            return uploadArea ? (uploadArea.getAttribute('data-folder') || SYSTEM_CONFIG.initialUploadFolder) : SYSTEM_CONFIG.initialUploadFolder;
        }
        
        // ===== SISTEMA DE SUBIR ARCHIVOS MEJORADO =====
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (!uploadArea || !fileInput) return;
            
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                fileInput.click();
            });
            
            fileInput.addEventListener('change', handleFileSelection);
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
        }
        
        function handleFiles(files) {
            const totalFiles = files.length;
            let processedFiles = 0;
            const targetFolder = getCurrentUploadFolder();
            
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = document.getElementById('progressPercentage');
            
            if (progressDiv && progressBar && progressPercentage) {
                progressDiv.style.display = 'block';
                progressBar.style.width = '0%';
                progressPercentage.textContent = '0%';
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                setTimeout(() => {
                    processFile(file, targetFolder);
                    processedFiles++;
                    
                    if (progressDiv && progressBar && progressPercentage) {
                        const progress = Math.round((processedFiles / totalFiles) * 100);
                        progressBar.style.width = `${progress}%`;
                        progressPercentage.textContent = `${progress}%`;
                    }
                    
                    if (processedFiles === totalFiles) {
                        setTimeout(() => {
                            if (progressDiv) progressDiv.style.display = 'none';
                            showNotification(`${totalFiles} archivo(s) subido(s) a la carpeta "${targetFolder}"`, 'success');
                            updateFileStats();
                            loadUploadedFilesList();
                            loadUploadedBooksList();
                            saveAllData();
                        }, 500);
                    }
                }, i * 300);
            }
        }
        
        function processFile(file, folder = SYSTEM_CONFIG.initialUploadFolder) {
            const fileType = getFileType(file);
            const fileName = file.name;
            const bookName = fileName.replace(/\.[^/.]+$/, "").trim();
            
            const fileData = {
                id: Date.now() + Math.random(),
                name: fileName,
                bookName: bookName,
                size: formatFileSize(file.size),
                type: fileType,
                date: new Date().toLocaleString(),
                url: URL.createObjectURL(file),
                folder: folder // NUEVO: Especificar en qu√© carpeta est√°
            };
            
            uploadedFiles.push(fileData);
            
            // A√±adir a la carpeta correspondiente
            if (!fileFolders[folder]) {
                fileFolders[folder] = [];
            }
            fileFolders[folder].push(fileData.id);
            
            if (fileType === 'pdf' && !uploadedBooks.includes(bookName)) {
                uploadedBooks.push(bookName);
                showNotification(`Libro "${bookName}" agregado a la carpeta "${folder}"`, 'info');
            }
            
            fileStats[fileType]++;
            fileStats.total++;
        }
        
        // ===== SISTEMA DE ENV√çO MEJORADO =====
        function sendPurchaseFiles(purchaseData) {
            return new Promise((resolve, reject) => {
                try {
                    // 1. Buscar archivos PDF subidos a la carpeta "inicio"
                    const inicioFiles = uploadedFiles.filter(file => 
                        file.folder === "inicio" && file.type === "pdf"
                    );
                    
                    if (inicioFiles.length === 0) {
                        showNotification("No hay archivos PDF en la carpeta 'inicio' para enviar", "error");
                        reject(new Error("No hay archivos para enviar"));
                        return;
                    }
                    
                    // 2. Preparar datos del env√≠o
                    const purchaseId = "PUR" + Date.now().toString().slice(-8);
                    const sentData = {
                        id: purchaseId,
                        date: new Date().toLocaleString(),
                        customer: purchaseData.customer || "Cliente",
                        amount: purchaseData.amount || 0,
                        files: inicioFiles.map(file => ({
                            name: file.name,
                            bookName: file.bookName,
                            size: file.size
                        })),
                        sentTo: {
                            email: purchaseData.email || SYSTEM_CONFIG.emailService.defaultEmail,
                            whatsapp: purchaseData.phone || SYSTEM_CONFIG.whatsapp
                        }
                    };
                    
                    // 3. Agregar a registro de env√≠os
                    sentFiles.push(sentData);
                    saveToLocalStorage('sentFiles', sentFiles);
                    
                    // 4. Simular env√≠o por diferentes m√©todos
                    if (SYSTEM_CONFIG.emailService.sendMethod === "email" || SYSTEM_CONFIG.emailService.sendMethod === "both") {
                        simulateEmailSend(sentData);
                    }
                    
                    if (SYSTEM_CONFIG.emailService.sendMethod === "whatsapp" || SYSTEM_CONFIG.emailService.sendMethod === "both") {
                        simulateWhatsAppSend(sentData);
                    }
                    
                    // 5. Mover archivos a carpeta "ventas" (opcional)
                    moveFilesToSalesFolder(inicioFiles.map(f => f.id));
                    
                    // 6. Crear enlace de descarga directa
                    createDownloadLinks(inicioFiles, purchaseId);
                    
                    showNotification(`Archivos enviados correctamente. ID de compra: ${purchaseId}`, 'success');
                    resolve(sentData);
                    
                } catch (error) {
                    console.error("Error al enviar archivos:", error);
                    showNotification("Error al enviar archivos. Por favor contacta al soporte.", "error");
                    reject(error);
                }
            });
        }
        
        function simulateEmailSend(sentData) {
            // Simulaci√≥n de env√≠o por email
            console.log(`Simulando env√≠o por email a: ${sentData.sentTo.email}`);
            console.log(`Archivos adjuntos: ${sentData.files.map(f => f.name).join(', ')}`);
            
            // En un sistema real, aqu√≠ ir√≠a la conexi√≥n a un servicio de email
            setTimeout(() => {
                console.log(`Email enviado exitosamente a ${sentData.sentTo.email}`);
            }, 1000);
        }
        
        function simulateWhatsAppSend(sentData) {
            // Simulaci√≥n de env√≠o por WhatsApp
            console.log(`Simulando env√≠o por WhatsApp a: ${sentData.sentTo.whatsapp}`);
            console.log(`Mensaje con enlaces para ${sentData.files.length} archivos`);
            
            // En un sistema real, aqu√≠ ir√≠a la conexi√≥n a la API de WhatsApp
            setTimeout(() => {
                console.log(`Mensaje de WhatsApp enviado a ${sentData.sentTo.whatsapp}`);
            }, 1000);
        }
        
        function moveFilesToSalesFolder(fileIds) {
            fileIds.forEach(fileId => {
                const fileIndex = uploadedFiles.findIndex(f => f.id == fileId);
                if (fileIndex !== -1) {
                    // Cambiar carpeta a "ventas"
                    uploadedFiles[fileIndex].folder = "ventas";
                    
                    // Actualizar referencia en carpetas
                    Object.keys(fileFolders).forEach(folder => {
                        const idx = fileFolders[folder].indexOf(fileId);
                        if (idx !== -1) {
                            fileFolders[folder].splice(idx, 1);
                        }
                    });
                    
                    if (!fileFolders.ventas) fileFolders.ventas = [];
                    fileFolders.ventas.push(fileId);
                }
            });
            saveToLocalStorage('fileFolders', fileFolders);
        }
        
        function createDownloadLinks(files, purchaseId) {
            // Crear enlaces de descarga para los archivos
            const downloadContainer = document.getElementById('downloadSection');
            if (!downloadContainer) return;
            
            // Limpiar contenido anterior
            downloadContainer.innerHTML = '';
            
            // Crear enlace para cada archivo
            files.forEach(file => {
                const link = document.createElement('a');
                link.href = file.url;
                link.download = file.name;
                link.className = 'download-link';
                link.style.display = 'block';
                link.style.margin = '10px 0';
                link.style.padding = '10px';
                link.style.backgroundColor = '#f0f0f0';
                link.style.borderRadius = '5px';
                link.style.textDecoration = 'none';
                link.style.color = '#333';
                
                const icon = document.createElement('i');
                icon.className = 'fas fa-download';
                icon.style.marginRight = '10px';
                
                const text = document.createTextNode(`Descargar ${file.name}`);
                
                link.appendChild(icon);
                link.appendChild(text);
                downloadContainer.appendChild(link);
                
                // Tambi√©n mostrar informaci√≥n
                const info = document.createElement('div');
                info.className = 'download-info';
                info.innerHTML = `
                    <p><strong>ID de compra:</strong> ${purchaseId}</p>
                    <p><strong>Archivo:</strong> ${file.name}</p>
                    <p><strong>Fecha:</strong> ${new Date().toLocaleString()}</p>
                `;
                downloadContainer.appendChild(info);
            });
            
            // Mostrar secci√≥n de descarga
            downloadContainer.style.display = 'block';
        }
        
        // ===== FUNCIONES DE GESTI√ìN DE ARCHIVOS =====
        function loadUploadedFilesList() {
            const container = document.getElementById('filesListContainer');
            if (!container) return;
            
            if (uploadedFiles.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #94a3b8;">
                        <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                        <p>No hay archivos subidos todav√≠a</p>
                        <p style="font-size: 0.9rem;">Sube tus primeros archivos PDF o multimedia</p>
                    </div>
                `;
                return;
            }
            
            // Agrupar por carpeta
            const filesByFolder = {};
            uploadedFiles.forEach(file => {
                if (!filesByFolder[file.folder]) {
                    filesByFolder[file.folder] = [];
                }
                filesByFolder[file.folder].push(file);
            });
            
            let html = '';
            Object.keys(filesByFolder).forEach(folder => {
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: var(--cuban-blue); margin-bottom: 15px;">
                            <i class="fas fa-folder"></i> Carpeta: ${folder} (${filesByFolder[folder].length} archivos)
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
                `;
                
                filesByFolder[folder].slice().reverse().forEach(file => {
                    const icon = getFileIcon(file.type);
                    const color = getFileTypeColor(file.type);
                    
                    html += `
                        <div style="background: #252f4a; border-radius: 10px; padding: 15px; border-left: 4px solid ${color};">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <div style="font-size: 1.5rem; color: ${color};">
                                    ${icon}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${file.name}</div>
                                    <div style="font-size: 0.8rem; color: #94a3b8;">${file.size} ‚Ä¢ ${file.date}</div>
                                    <div style="font-size: 0.8rem; color: #ffcc00; margin-top: 5px;">
                                        <i class="fas fa-folder"></i> ${file.folder}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="tracker-btn" onclick="downloadFile('${file.id}')" style="padding: 5px 10px; font-size: 0.8rem; flex: 1;">
                                    <i class="fas fa-download"></i> Descargar
                                </button>
                                <button class="tracker-btn" onclick="deleteFile('${file.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: var(--tracker-danger);">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="tracker-btn" onclick="changeFileFolder('${file.id}')" style="padding: 5px 10px; font-size: 0.8rem; background: var(--tracker-primary);">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function changeFileFolder(fileId) {
            const file = uploadedFiles.find(f => f.id == fileId);
            if (!file) return;
            
            const currentFolder = file.folder;
            const newFolder = prompt(
                `Cambiar carpeta del archivo "${file.name}"\n\nCarpeta actual: ${currentFolder}\n\nNueva carpeta:`,
                currentFolder === "inicio" ? "ventas" : "inicio"
            );
            
            if (newFolder && newFolder.trim() && newFolder !== currentFolder) {
                // Actualizar carpeta en el archivo
                file.folder = newFolder.trim();
                
                // Actualizar referencia en fileFolders
                Object.keys(fileFolders).forEach(folder => {
                    const idx = fileFolders[folder].indexOf(parseFloat(fileId));
                    if (idx !== -1) {
                        fileFolders[folder].splice(idx, 1);
                    }
                });
                
                if (!fileFolders[newFolder]) {
                    fileFolders[newFolder] = [];
                }
                fileFolders[newFolder].push(parseFloat(fileId));
                
                saveToLocalStorage('fileFolders', fileFolders);
                loadUploadedFilesList();
                showNotification(`Archivo movido a la carpeta "${newFolder}"`, 'success');
            }
        }
        
        // ===== FUNCIONES DE PAGO MEJORADAS =====
        function processPayment(paymentData) {
            return new Promise((resolve, reject) => {
                try {
                    // 1. Procesar el pago
                    const paymentId = "PAY" + Date.now().toString().slice(-8);
                    const paymentResult = {
                        id: paymentId,
                        success: true,
                        amount: paymentData.amount,
                        method: paymentData.method,
                        date: new Date().toLocaleString(),
                        items: shoppingCart.map(item => ({
                            title: item.title,
                            price: item.price,
                            quantity: item.quantity
                        }))
                    };
                    
                    // 2. Registrar la venta
                    recordSale(paymentResult);
                    
                    // 3. Enviar archivos autom√°ticamente
                    sendPurchaseFiles({
                        customer: paymentData.customer || "Cliente",
                        email: paymentData.email,
                        phone: paymentData.phone,
                        amount: paymentData.amount
                    }).then(sentData => {
                        // 4. Mostrar confirmaci√≥n con enlaces de descarga
                        showPaymentSuccess(paymentResult, sentData);
                        resolve({ payment: paymentResult, files: sentData });
                    }).catch(error => {
                        // Si hay error enviando archivos, notificar pero marcar pago como exitoso
                        showNotification("Pago procesado pero hubo un error enviando los archivos. Contacta al soporte.", "error");
                        resolve({ payment: paymentResult, files: null });
                    });
                    
                } catch (error) {
                    console.error("Error procesando pago:", error);
                    showNotification("Error procesando el pago", "error");
                    reject(error);
                }
            });
        }
        
        function showPaymentSuccess(paymentResult, sentData) {
            // Mostrar modal de √©xito
            const modal = document.getElementById('paymentModal');
            const successSection = document.getElementById('paymentSuccess');
            const downloadSection = document.getElementById('downloadSection');
            
            if (modal && successSection) {
                successSection.style.display = 'block';
                
                // Actualizar informaci√≥n
                const paymentInfo = successSection.querySelector('p');
                if (paymentInfo) {
                    paymentInfo.innerHTML = `
                        Tu pago ha sido procesado correctamente.<br>
                        <strong>ID de Pago:</strong> ${paymentResult.id}<br>
                        <strong>Monto:</strong> $${paymentResult.amount}<br>
                        <strong>M√©todo:</strong> ${paymentResult.method}<br>
                        <strong>Fecha:</strong> ${paymentResult.date}
                    `;
                }
                
                // Limpiar carrito
                shoppingCart = [];
                saveCartToStorage();
                updateCartUI();
                
                // Si hay archivos enviados, mostrar informaci√≥n
                if (sentData) {
                    const downloadInfo = document.createElement('div');
                    downloadInfo.className = 'download-info';
                    downloadInfo.innerHTML = `
                        <p><strong>üìÅ Archivos enviados:</strong></p>
                        <ul style="padding-left: 20px;">
                            ${sentData.files.map(file => `<li>${file.name} (${file.size})</li>`).join('')}
                        </ul>
                        <p><small>Los archivos han sido enviados a tu email y WhatsApp</small></p>
                    `;
                    
                    if (downloadSection) {
                        downloadSection.appendChild(downloadInfo);
                    }
                }
            }
        }
        
        // ===== FUNCIONES AUXILIARES MEJORADAS =====
        function downloadFile(fileId) {
            const file = uploadedFiles.find(f => f.id == fileId);
            if (file) {
                showNotification(`Descargando: ${file.name}`, 'info');
                const link = document.createElement('a');
                link.href = file.url;
                link.download = file.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Registrar descarga
                recordDownload(file);
            }
        }
        
        function recordDownload(file) {
            const downloads = loadFromLocalStorage('fileDownloads') || [];
            downloads.push({
                fileId: file.id,
                fileName: file.name,
                date: new Date().toLocaleString(),
                folder: file.folder
            });
            saveToLocalStorage('fileDownloads', downloads);
        }
        
        function deleteFile(fileId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este archivo?')) {
                const fileIndex = uploadedFiles.findIndex(f => f.id == fileId);
                if (fileIndex !== -1) {
                    const file = uploadedFiles[fileIndex];
                    const fileType = file.type;
                    const bookName = file.bookName;
                    
                    // Eliminar de uploadedFiles
                    uploadedFiles.splice(fileIndex, 1);
                    
                    // Eliminar de fileFolders
                    Object.keys(fileFolders).forEach(folder => {
                        const idx = fileFolders[folder].indexOf(parseFloat(fileId));
                        if (idx !== -1) {
                            fileFolders[folder].splice(idx, 1);
                        }
                    });
                    
                    // Si es PDF, verificar si hay otros archivos con el mismo nombre
                    if (fileType === 'pdf') {
                        const hasOtherBooksWithSameName = uploadedFiles.some(f => 
                            f.bookName === bookName && f.type === 'pdf'
                        );
                        
                        if (!hasOtherBooksWithSameName) {
                            const bookIndex = uploadedBooks.indexOf(bookName);
                            if (bookIndex !== -1) {
                                uploadedBooks.splice(bookIndex, 1);
                            }
                        }
                    }
                    
                    // Actualizar estad√≠sticas
                    fileStats[fileType]--;
                    fileStats.total--;
                    
                    updateFileStats();
                    loadUploadedFilesList();
                    loadUploadedBooksList();
                    saveAllData();
                    showNotification('Archivo eliminado correctamente', 'success');
                }
            }
        }
        
        // ===== INICIALIZACI√ìN MEJORADA =====
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos guardados
            loadSavedData();
            
            // Inicializar carpetas
            setupInitialFolder();
            
            // Cargar archivos enviados
            const savedSentFiles = loadFromLocalStorage('sentFiles');
            if (savedSentFiles) sentFiles = savedSentFiles;
            
            // Inicializar componentes
            loadCartFromStorage();
            loadCalendarEvents();
            updateSmallAlmanac();
            updateStatsUI();
            updateCurrentTime();
            updateRaffleTimer();
            updateRaffleInfo();
            
            // Configurar subida de archivos
            setupFileUpload();
            
            // Configurar intervalos
            setInterval(updateCurrentTime, 1000);
            setInterval(updateRaffleTimer, 1000);
            setInterval(saveAllData, 30000);
            
            // Eventos del calendario
            document.getElementById('toggleFullCalendarBtn')?.addEventListener('click', toggleFullCalendar);
            document.getElementById('hideFullCalendarBtn')?.addEventListener('click', toggleFullCalendar);
            document.getElementById('prevYearBtn')?.addEventListener('click', () => changeYear(-1));
            document.getElementById('nextYearBtn')?.addEventListener('click', () => changeYear(1));
            
            // Eventos del calendario de eventos
            document.getElementById('monthSelect')?.addEventListener('change', loadCalendarEvents);
            document.getElementById('countrySelect')?.addEventListener('change', loadCalendarEvents);
            document.getElementById('typeSelect')?.addEventListener('change', loadCalendarEvents);
            
            // Eventos del almanaque
            document.getElementById('refreshAlmanacBtn')?.addEventListener('click', updateSmallAlmanac);
            
            // Eventos del carrito (mantener originales)
            // ... (eventos originales del carrito) ...
            
            // MODIFICACI√ìN CR√çTICA: Actualizar el evento de checkout para usar el nuevo sistema
            document.getElementById('checkoutBtn')?.addEventListener('click', function(e) {
                e.stopPropagation();
                if (shoppingCart.length === 0) {
                    showNotification('Tu carrito est√° vac√≠o', 'error');
                    return;
                }
                
                // Obtener datos del cliente (simulado)
                const customerEmail = prompt("Ingresa tu email para recibir los archivos:", "ejemplo@email.com");
                const customerPhone = prompt("Ingresa tu n√∫mero de WhatsApp:", "+5355555555");
                
                if (customerEmail || customerPhone) {
                    const total = calculateCartTotal();
                    
                    processPayment({
                        customer: "Cliente",
                        email: customerEmail,
                        phone: customerPhone,
                        amount: total,
                        method: "Transferm√≥vil"
                    }).then(result => {
                        console.log("Pago procesado:", result);
                    }).catch(error => {
                        console.error("Error en pago:", error);
                    });
                }
            });
            
            // Eventos de WhatsApp
            document.getElementById('whatsappCubaBtn')?.addEventListener('click', redirectToWhatsApp);
            document.getElementById('whatsappContactBtn')?.addEventListener('click', redirectToWhatsApp);
            document.getElementById('footerWhatsappBtn')?.addEventListener('click', redirectToWhatsApp);
            
            // Resto de eventos originales...
            // ... (mantener todos los dem√°s eventos originales) ...
            
            // Cargar lista de archivos al iniciar
            loadUploadedFilesList();
            loadUploadedBooksList();
            updateFileStats();
            
            // Mostrar notificaci√≥n de bienvenida
            setTimeout(() => {
                showNotification('¬°Sistema mejorado! Ahora los archivos se env√≠an autom√°ticamente despu√©s del pago.', 'info');
            }, 1000);
        });
        
        // ===== FUNCIONES ORIGINALES QUE SE MANTIENEN =====
        // Las siguientes funciones se mantienen igual que en tu c√≥digo original:
        // - loadSavedData(), saveAllData(), saveToLocalStorage(), loadFromLocalStorage()
        // - updateSmallAlmanac(), getCountryFlag(), getTypeName()
        // - generateYearCalendar(), toggleFullCalendar(), changeYear()
        // - loadCalendarEvents(), isTodayDate(), getCountryName()
        // - updateCurrentTime(), updateRaffleTimer(), updateRaffleInfo()
        // - loadCartFromStorage(), saveCartToStorage(), addToCart(), updateCartItemQuantity()
        // - removeCartItem(), clearCart(), calculateCartTotal(), updateCartUI()
        // - updateCartDropdown(), updateCartPage(), updateCashPayment()
        // - processCashPayment(), getFileType(), formatFileSize()
        // - updateFileStats(), loadUploadedBooksList(), getFileIcon(), getFileTypeColor()
        // - updateStatsUI(), simulateSale(), simulateMultipleSales(), resetStats()
        // - redirectToWhatsApp(), saveRaffleData(), showLogin(), hideLogin()
        // - login(), logoutAdmin(), showAdminSection(), saveSalesConfig()
        // - participateRaffle(), showNotification()
        // ... (todas las dem√°s funciones originales) ...
        
    </script>
</body>
</html>
